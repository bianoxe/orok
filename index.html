<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ XO | –ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .game-container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–∏ */
        .invite-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            display: none;
            align-items: center;
            gap: 15px;
            animation: slideDown 0.3s ease;
        }

        .invite-notification.show {
            display: flex;
        }

        .invite-text {
            font-weight: 600;
            font-size: 1.1em;
        }

        .invite-actions {
            display: flex;
            gap: 10px;
        }

        .invite-accept {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .invite-decline {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .invite-accept:hover, .invite-decline:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .header h1 {
            font-size: 3em;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header p {
            color: #666;
            font-size: 1.2em;
        }

        /* –°–∫—Ä—ã—Ç–∏–µ –≤–∫–ª–∞–¥–æ–∫ –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã */
        .game-section-active .main-tabs {
            display: none;
        }

        .game-section-active .header p {
            display: none;
        }

        /* –ö–Ω–æ–ø–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ */
        .account-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            z-index: 100;
        }

        .account-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–∫–∫–∞—É–Ω—Ç–∞ */
        .account-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .account-modal.active {
            display: flex;
        }

        .account-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .account-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .account-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .account-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .account-btn-primary {
            flex: 1;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .account-btn-secondary {
            flex: 1;
            background: #95a5a6;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .account-btn-primary:hover, .account-btn-secondary:hover {
            transform: translateY(-2px);
        }

        .account-error {
            color: #e74c3c;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .account-success {
            color: #27ae60;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .account-menu {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .account-info {
            background: rgba(102, 126, 234, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .username {
            font-weight: bold;
            color: #667eea;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≥–ª–∞–≤–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫ */
        .main-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .tab {
            padding: 12px 25px;
            border: none;
            background: transparent;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #666;
            margin: 0 5px;
        }

        .tab:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            transform: translateY(-2px);
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ */
        .community-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .community-tab {
            padding: 10px 20px;
            border: none;
            background: transparent;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #666;
            margin: 0 5px;
        }

        .community-tab:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .community-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .community-content {
            display: none;
        }

        .community-content.active {
            display: block;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ –¥—Ä—É–∑–µ–π */
        .friends-list, .all-users-list, .friend-requests-list {
            max-height: 500px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .friend-item, .user-item, .request-item {
            background: white;
            margin: 10px 0;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
        }

        .friend-info, .user-info, .request-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .friend-avatar, .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2em;
        }

        .friend-details, .user-details {
            flex: 1;
        }

        .friend-name, .user-name {
            font-weight: bold;
            color: #2c3e50;
        }

        .friend-status, .user-status {
            font-size: 0.9em;
            color: #7f8c8d;
        }

        .status-online {
            color: #27ae60;
            font-weight: bold;
        }

        .status-ingame {
            color: #e74c3c;
            font-weight: bold;
        }

        .status-offline {
            color: #95a5a6;
        }

        .friend-actions, .user-actions, .request-actions {
            display: flex;
            gap: 10px;
        }

        .friend-btn, .user-btn, .request-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-invite {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-add {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-accept {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-decline {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-remove {
            background: linear-gradient(135deg, #e74c3c, #c0392b) !important;
            color: white;
        }

        .friend-btn:hover, .user-btn:hover, .request-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .btn-remove:hover {
            background: linear-gradient(135deg, #c0392b, #a93226) !important;
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(231, 76, 60, 0.3);
        }

        .section-title {
            font-size: 1.3em;
            color: #2c3e50;
            margin: 20px 0 10px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }

        .add-friend-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 0;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .add-friend-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫–∏–Ω–æ–≤ */
        .skins-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .skin-item {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 3px solid transparent;
        }

        .skin-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .skin-item.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .skin-preview {
            font-size: 3em;
            margin-bottom: 10px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .skin-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .skin-price {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .skin-owned {
            color: #27ae60;
            font-weight: bold;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –¥—Ä—É–∑–µ–π –≤ –ª–æ–±–±–∏ */
        .invite-friends-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .invite-title {
            font-size: 1.2em;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }

        .invite-friends-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .invite-item {
            background: white;
            margin: 8px 0;
            padding: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .invite-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .invite-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        .invite-details {
            flex: 1;
        }

        .invite-action {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .invite-btn {
            padding: 6px 12px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .invite-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(39, 174, 96, 0.4);
        }

        .invite-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .invite-btn-sent {
            padding: 6px 12px;
            background: #95a5a6 !important;
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            cursor: not-allowed;
            transition: all 0.3s ease;
        }

        .invite-btn-offline {
            padding: 6px 12px;
            background: #bdc3c7 !important;
            color: #7f8c8d;
            border: none;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            cursor: not-allowed;
            transition: all 0.3s ease;
        }

        .decline-message {
            font-size: 0.8em;
            color: #e74c3c;
            margin-top: 5px;
            text-align: center;
        }

        .invite-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .invite-help {
            text-align: center;
            margin-top: 15px;
            color: #7f8c8d;
            font-size: 0.9em;
            font-style: italic;
        }

        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ */
        .status-online {
            color: #27ae60;
            font-weight: bold;
            font-size: 0.85em;
        }

        .status-ingame {
            color: #e67e22;
            font-weight: bold;
            font-size: 0.85em;
        }

        .status-offline {
            color: #95a5a6;
            font-size: 0.85em;
        }

        .main-menu {
            text-align: center;
            padding: 40px 0;
        }

        .menu-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .menu-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            min-width: 200px;
        }

        .menu-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        .menu-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .menu-btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        .board-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .board {
            display: grid;
            gap: 8px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 12px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .cell {
            background: white;
            border: none;
            border-radius: 10px;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .cell.size-3 { width: 100px; height: 100px; font-size: 2.5em; }
        .cell.size-4 { width: 80px; height: 80px; font-size: 2em; }
        .cell.size-5 { width: 70px; height: 70px; font-size: 1.8em; }
        .cell.size-7 { width: 60px; height: 60px; font-size: 1.5em; }
        .cell.size-8 { width: 55px; height: 55px; font-size: 1.4em; }
        .cell.size-10 { width: 50px; height: 50px; font-size: 1.2em; }

        .cell:hover:not(:disabled) {
            background: #f8f9fa;
            transform: scale(1.05);
        }

        .cell.x {
            color: #e74c3c;
            text-shadow: 0 2px 5px rgba(231, 76, 60, 0.3);
        }

        .cell.o {
            color: #3498db;
            text-shadow: 0 2px 5px rgba(52, 152, 219, 0.3);
        }

        .cell.triangle {
            color: #f39c12;
            text-shadow: 0 2px 5px rgba(243, 156, 18, 0.3);
        }

        .cell.diamond {
            color: #9b59b6;
            text-shadow: 0 2px 5px rgba(155, 89, 182, 0.3);
        }

        .cell:disabled {
            cursor: not-allowed;
            transform: none;
        }

        .cell:disabled:hover {
            background: white;
            transform: none;
        }

        .game-status {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.2em;
            font-weight: 600;
            text-align: center;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            min-width: 300px;
        }

        .lobby-info {
            background: rgba(102, 126, 234, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .player-info {
            font-size: 1.1em;
            margin: 10px 0;
        }

        .symbol {
            font-weight: bold;
            padding: 5px 15px;
            border-radius: 20px;
            margin-left: 10px;
        }

        .symbol.x {
            background: #e74c3c;
            color: white;
        }

        .symbol.o {
            background: #3498db;
            color: white;
        }

        .symbol.triangle {
            background: #f39c12;
            color: white;
        }

        .symbol.diamond {
            background: #9b59b6;
            color: white;
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .player-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            border-left: 4px solid;
        }

        .player-card.x { border-color: #e74c3c; }
        .player-card.o { border-color: #3498db; }
        .player-card.triangle { border-color: #f39c12; }
        .player-card.diamond { border-color: #9b59b6; }

        .player-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .player-status {
            font-size: 0.9em;
            color: #666;
        }

        .lobby-list {
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
        }

        .lobby-item {
            background: white;
            margin: 15px 0;
            padding: 20px;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        .lobby-item:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .lobby-info-panel {
            text-align: left;
            flex: 1;
        }

        .lobby-name {
            font-weight: bold;
            font-size: 1.3em;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .lobby-settings {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .lobby-players {
            color: #667eea;
            font-size: 0.9em;
            font-weight: 600;
        }

        .join-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(39, 174, 96, 0.4);
        }

        .join-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.6);
        }

        .settings-panel {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin: 20px 0;
        }

        .setting-group {
            margin: 20px 0;
        }

        .setting-label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .setting-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .setting-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
        }

        .checkbox-input {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .mode-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .mode-option {
            flex: 1;
            min-width: 150px;
        }

        .mode-btn {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
        }

        .mode-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .mode-btn.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .players-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .players-option {
            flex: 1;
            min-width: 120px;
        }

        .players-btn {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
        }

        .players-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .players-btn.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .difficulty-group {
            display: none;
            margin: 20px 0;
            padding: 20px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .difficulty-group.visible {
            display: block;
        }

        .difficulty-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .difficulty-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
        }

        .difficulty-btn:hover {
            border-color: #667eea;
        }

        .difficulty-btn.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .message {
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
        }

        .waiting-message {
            background: linear-gradient(135deg, #f39c12, #f1c40f);
            color: white;
        }

        .ready-message {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 30px 0;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #e67e22, #e74c3c);
            color: white;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .account-btn {
                position: relative;
                top: auto;
                right: auto;
                margin-bottom: 20px;
            }

            .main-tabs {
                flex-direction: column;
                gap: 10px;
            }

            .tab {
                width: 100%;
                margin: 0;
            }

            .community-tabs {
                flex-direction: column;
                gap: 10px;
            }

            .community-tab {
                width: 100%;
                margin: 0;
            }

            .menu-buttons {
                flex-direction: column;
                align-items: center;
            }

            .menu-btn {
                width: 100%;
                max-width: 300px;
            }

            .cell.size-3 { width: 80px; height: 80px; font-size: 2em; }
            .cell.size-4 { width: 65px; height: 65px; font-size: 1.6em; }
            .cell.size-5 { width: 55px; height: 55px; font-size: 1.4em; }
            .cell.size-7 { width: 45px; height: 45px; font-size: 1.2em; }
            .cell.size-8 { width: 40px; height: 40px; font-size: 1.1em; }
            .cell.size-10 { width: 35px; height: 35px; font-size: 1em; }

            .lobby-item {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .friend-item, .user-item, .request-item {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .friend-info, .user-info, .request-info {
                flex-direction: column;
                text-align: center;
            }

            .friend-actions, .user-actions, .request-actions {
                justify-content: center;
                flex-direction: column;
                gap: 8px;
                width: 100%;
            }

            .friend-btn {
                width: 100%;
                margin: 2px 0;
            }

            .action-buttons {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                max-width: 300px;
            }

            .mode-group, .players-group {
                flex-direction: column;
            }

            .difficulty-options {
                flex-direction: column;
            }

            .players-grid {
                grid-template-columns: 1fr;
            }

            .skins-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }

            .invite-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .invite-item {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .invite-info {
                flex-direction: column;
                text-align: center;
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8, #6a4190);
        }
    </style>
</head>
<body>
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–∏ -->
    <div class="invite-notification" id="inviteNotification">
        <div class="invite-text" id="inviteText"></div>
        <div class="invite-actions">
            <button class="invite-accept" id="acceptInvite">–ü—Ä–∏–Ω—è—Ç—å</button>
            <button class="invite-decline" id="declineInvite">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
        </div>
    </div>

    <div class="game-container">
        <!-- –ö–Ω–æ–ø–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ -->
        <button class="account-btn" id="accountBtn">üë§ –ê–∫–∫–∞—É–Ω—Ç</button>

        <div class="header">
            <h1>üéÆ XO</h1>
            <p>–ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏ —Å –¥—Ä—É–∑—å—è–º–∏ –æ–Ω–ª–∞–π–Ω!</p>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–∫–∫–∞—É–Ω—Ç–∞ -->
        <div class="account-modal" id="accountModal">
            <div class="account-content">
                <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
                <div id="loginForm">
                    <div class="account-title">–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç</div>
                    <div class="account-form">
                        <div class="form-group">
                            <label class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                            <input type="text" id="loginUsername" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                            <input type="password" id="loginPassword" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                        </div>
                        <div class="account-error" id="loginError"></div>
                        <div class="account-actions">
                            <button class="account-btn-primary" id="loginBtn">–í–æ–π—Ç–∏</button>
                            <button class="account-btn-secondary" id="showRegisterBtn">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                        </div>
                    </div>
                </div>

                <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
                <div id="registerForm" class="hidden">
                    <div class="account-title">–°–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞</div>
                    <div class="account-form">
                        <div class="form-group">
                            <label class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                            <input type="text" id="registerUsername" class="form-input" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –Ω–∏–∫">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                            <input type="password" id="registerPassword" class="form-input" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                            <input type="password" id="registerConfirmPassword" class="form-input" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                        </div>
                        <div class="account-error" id="registerError"></div>
                        <div class="account-success" id="registerSuccess"></div>
                        <div class="account-actions">
                            <button class="account-btn-primary" id="registerBtn">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                            <button class="account-btn-secondary" id="showLoginBtn">–ù–∞–∑–∞–¥ –∫ –≤—Ö–æ–¥—É</button>
                        </div>
                    </div>
                </div>

                <!-- –ú–µ–Ω—é –∞–∫–∫–∞—É–Ω—Ç–∞ -->
                <div id="accountMenu" class="hidden">
                    <div class="account-title">–ú–æ–π –∞–∫–∫–∞—É–Ω—Ç</div>
                    <div class="account-info">
                        –í—ã –≤–æ—à–ª–∏ –∫–∞–∫: <span class="username" id="currentUsername">–ì–æ—Å—Ç—å</span>
                    </div>
                    <div class="account-menu">
                        <button class="account-btn-primary" id="accountSettingsBtn">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
                        <button class="account-btn-secondary" id="logoutBtn">–í—ã–π—Ç–∏</button>
                    </div>
                </div>

                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ -->
                <div id="accountSettings" class="hidden">
                    <div class="account-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞</div>
                    <div class="account-form">
                        <div class="form-group">
                            <label class="form-label">–ù–æ–≤–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                            <input type="text" id="newUsername" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –Ω–∏–∫">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                            <input type="password" id="newPassword" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                            <input type="password" id="newConfirmPassword" class="form-input" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
                        </div>
                        <div class="account-error" id="settingsError"></div>
                        <div class="account-success" id="settingsSuccess"></div>
                        <div class="account-actions">
                            <button class="account-btn-primary" id="saveSettingsBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <button class="account-btn-secondary" id="backToAccountBtn">–ù–∞–∑–∞–¥</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ì–ª–∞–≤–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ -->
        <div class="main-tabs">
            <button class="tab active" data-tab="game">üéÆ –ò–≥—Ä–∞</button>
            <button class="tab" data-tab="community">üë• –°–æ–æ–±—â–µ—Å—Ç–≤–æ</button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ò–≥—Ä–∞ -->
        <div id="gameTab" class="tab-content">
            <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
            <div id="mainMenu" class="main-menu">
                <div class="menu-buttons">
                    <button id="quickPlay" class="menu-btn">‚ö° –ë—ã—Å—Ç—Ä–∞—è –∏–≥—Ä–∞</button>
                    <button id="createGame" class="menu-btn">üéØ –°–æ–∑–¥–∞—Ç—å –ª–æ–±–±–∏</button>
                    <button id="showLobbies" class="menu-btn">üåê –°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤</button>
                </div>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ –ª–æ–±–±–∏ -->
            <div id="lobbyListSection" class="hidden">
                <h2 style="text-align: center; margin-bottom: 20px; color: #2c3e50;">üåê –î–æ—Å—Ç—É–ø–Ω—ã–µ –ª–æ–±–±–∏</h2>
                <div class="lobby-list" id="lobbyList">
                    <div class="empty-state" style="text-align: center; padding: 40px; color: #7f8c8d;">
                        –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–±–±–∏...
                    </div>
                </div>
                <div class="action-buttons">
                    <button id="backToMain" class="btn btn-warning">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
            </div>

            <!-- –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–±–±–∏ -->
            <div id="createLobbySection" class="hidden">
                <h2 style="text-align: center; margin-bottom: 20px; color: #2c3e50;">üéØ –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–±–±–∏</h2>
                <div class="settings-panel">
                    <div class="setting-group">
                        <label class="setting-label">üé™ –ù–∞–∑–≤–∞–Ω–∏–µ –ª–æ–±–±–∏:</label>
                        <input type="text" id="lobbyNameInput" class="setting-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–æ–±–±–∏" maxlength="20">
                    </div>

                    <div class="setting-group">
                        <label class="setting-label">üéÆ –†–µ–∂–∏–º –∏–≥—Ä—ã:</label>
                        <div class="mode-group">
                            <div class="mode-option">
                                <button class="mode-btn selected" data-mode="online">üåê –û–Ω–ª–∞–π–Ω</button>
                            </div>
                            <div class="mode-option">
                                <button class="mode-btn" data-mode="bot">ü§ñ –° –±–æ—Ç–æ–º</button>
                            </div>
                            <div class="mode-option">
                                <button class="mode-btn" data-mode="local">üë• –õ–æ–∫–∞–ª—å–Ω—ã–π</button>
                            </div>
                        </div>
                    </div>

                    <div class="setting-group">
                        <label class="setting-label">üë• –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤:</label>
                        <div class="players-group">
                            <div class="players-option">
                                <button class="players-btn selected" data-players="2">2 –∏–≥—Ä–æ–∫–∞</button>
                            </div>
                            <div class="players-option">
                                <button class="players-btn" data-players="3">3 –∏–≥—Ä–æ–∫–∞</button>
                            </div>
                            <div class="players-option">
                                <button class="players-btn" data-players="4">4 –∏–≥—Ä–æ–∫–∞</button>
                            </div>
                        </div>
                    </div>

                    <div id="difficultyGroup" class="difficulty-group">
                        <label class="setting-label">‚ö° –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:</label>
                        <div class="difficulty-options">
                            <button class="difficulty-btn selected" data-difficulty="easy">üòä –õ–µ–≥–∫–∏–π</button>
                            <button class="difficulty-btn" data-difficulty="medium">üòê –ù–æ—Ä–º–∞–ª—å–Ω—ã–π</button>
                            <button class="difficulty-btn" data-difficulty="hard">üß† –°–ª–æ–∂–Ω—ã–π</button>
                        </div>
                    </div>

                    <div class="setting-group">
                        <label class="setting-label">üìê –†–∞–∑–º–µ—Ä –ø–æ–ª—è:</label>
                        <select id="boardSizeSelect" class="setting-control">
                            <option value="3">3√ó3 (–ö–ª–∞—Å—Å–∏–∫–∞)</option>
                            <option value="4">4√ó4</option>
                            <option value="5">5√ó5</option>
                            <option value="7">7√ó7</option>
                            <option value="8">8√ó8</option>
                            <option value="10">10√ó10</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label class="setting-label">üèÜ –§–∏–≥—É—Ä –¥–ª—è –ø–æ–±–µ–¥—ã:</label>
                        <select id="winLengthSelect" class="setting-control">
                            <option value="3">3 —Ñ–∏–≥—É—Ä—ã</option>
                            <option value="4">4 —Ñ–∏–≥—É—Ä—ã</option>
                            <option value="5">5 —Ñ–∏–≥—É—Ä</option>
                            <option value="6">6 —Ñ–∏–≥—É—Ä</option>
                        </select>
                    </div>

                    <div class="checkbox-group" id="autoStartGroup">
                        <input type="checkbox" id="autoStartCheckbox" class="checkbox-input" checked>
                        <label class="setting-label">‚ö° –ù–∞—á–∏–Ω–∞—Ç—å –∏–≥—Ä—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</label>
                    </div>
                    <div style="color: #7f8c8d; font-size: 0.9em; margin-left: 30px;">
                        –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ, –∏–≥—Ä–∞ –Ω–∞—á–Ω–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
                    </div>
                </div>

                <div class="action-buttons">
                    <button id="confirmCreate" class="btn btn-success">üöÄ –°–æ–∑–¥–∞—Ç—å –ª–æ–±–±–∏</button>
                    <button id="cancelCreate" class="btn btn-warning">‚ùå –û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>

            <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
            <div id="gameSection" class="hidden">
                <div class="game-status" id="status">‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤...</div>

                <div class="lobby-info">
                    <div id="currentLobbyName" style="font-size: 1.3em; font-weight: bold; margin-bottom: 10px;"></div>
                    <div id="lobbySettings" style="color: #666; margin-bottom: 10px;"></div>
                    <div class="player-info">
                        –í—ã –∏–≥—Ä–∞–µ—Ç–µ –∑–∞: <span id="playerSymbol" class="symbol"></span>
                    </div>
                    <div id="gameModeInfo" style="margin-top: 10px; font-weight: 600;"></div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –¥—Ä—É–∑–µ–π (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è –ª–æ–±–±–∏) -->
                    <div id="inviteFriendsBtnContainer" class="hidden" style="margin: 15px 0;">
                        <button id="showInviteFriendsBtn" class="btn btn-success">
                            üë• –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–∑–µ–π –≤ –ª–æ–±–±–∏
                        </button>
                    </div>
                    
                    <!-- –°–µ—Ç–∫–∞ –∏–≥—Ä–æ–∫–æ–≤ -->
                    <div id="playersGrid" class="players-grid"></div>
                </div>

                <!-- –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥—Ä—É–∑–µ–π –≤ –ª–æ–±–±–∏ -->
                <div id="inviteFriendsSection" class="invite-friends-section hidden">
                    <div class="invite-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div class="invite-title">üë• –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–∑–µ–π –≤ –ª–æ–±–±–∏</div>
                        <button id="hideInviteFriendsBtn" class="btn btn-warning" style="padding: 8px 15px;">‚úï –°–∫—Ä—ã—Ç—å</button>
                    </div>
                    <div class="invite-friends-list" id="inviteFriendsList">
                        <!-- –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è -->
                    </div>
                    <div class="invite-help" style="text-align: center; margin-top: 15px; color: #7f8c8d; font-size: 0.9em;">
                        üí° –î—Ä—É–∑—å—è –ø–æ–ª—É—á–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–∏ –∫–æ–≥–¥–∞ –ø–æ—è–≤—è—Ç—Å—è –æ–Ω–ª–∞–π–Ω
                    </div>
                </div>

                <!-- –û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ -->
                <div id="waitingSection">
                    <div class="message waiting-message pulse" id="waitingMessage">
                        ‚è≥ –û–∂–∏–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤...
                    </div>
                    <div class="action-buttons">
                        <button id="leaveWaitingBtn" class="btn btn-warning">üö™ –ü–æ–∫–∏–Ω—É—Ç—å –ª–æ–±–±–∏</button>
                    </div>
                </div>

                <!-- –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏–≥—Ä–µ -->
                <div id="readySection" class="hidden">
                    <div class="message ready-message">
                        ‚úÖ –í—Å–µ –∏–≥—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã! 
                        <div id="readyMessage" style="margin-top: 10px;"></div>
                    </div>
                    <div class="action-buttons">
                        <button id="startGameBtn" class="btn btn-success pulse">üéÆ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É!</button>
                        <button id="leaveReadyBtn" class="btn btn-warning">üö™ –ü–æ–∫–∏–Ω—É—Ç—å –ª–æ–±–±–∏</button>
                    </div>
                </div>

                <!-- –ò–≥—Ä–æ–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å -->
                <div id="gameContent" class="hidden">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div class="game-info" style="background: rgba(102, 126, 234, 0.1); padding: 15px; border-radius: 10px; display: inline-block;">
                            <strong>üéØ –¶–µ–ª—å:</strong> —Å–æ—Å—Ç–∞–≤–∏—Ç—å <span id="winLengthInfo" style="font-weight: bold; color: #667eea;"></span> –≤ —Ä—è–¥
                        </div>
                    </div>

                    <div class="board-container">
                        <div class="board" id="board"></div>
                    </div>

                    <div class="action-buttons">
                        <button id="restartGame" class="btn btn-primary">üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
                        <button id="leaveGame" class="btn btn-warning">üö™ –ü–æ–∫–∏–Ω—É—Ç—å –ª–æ–±–±–∏</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –°–æ–æ–±—â–µ—Å—Ç–≤–æ -->
        <div id="communityTab" class="tab-content hidden">
            <div class="community-tabs">
                <button class="community-tab active" data-community-tab="friends">üë• –î—Ä—É–∑—å—è</button>
                <button class="community-tab" data-community-tab="skins">üé® –°–∫–∏–Ω—ã</button>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –î—Ä—É–∑—å—è -->
            <div id="friendsContent" class="community-content active">
                <div class="section-title">–ú–æ–∏ –¥—Ä—É–∑—å—è</div>
                <div class="friends-list" id="friendsList">
                    <!-- –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>

                <button class="add-friend-btn" id="addFriendBtn">+ –î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞</button>

                <div class="section-title">–ú–æ–∏ –∑–∞—è–≤–∫–∏</div>
                <div class="friend-requests-list" id="friendRequestsList">
                    <!-- –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ –≤ –¥—Ä—É–∑—å—è –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>

                <!-- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                <div id="allUsersSection" class="hidden">
                    <div class="section-title">–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
                    <div class="all-users-list" id="allUsersList">
                        <!-- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                    </div>
                    <button class="add-friend-btn" id="backToFriendsBtn">‚Üê –ù–∞–∑–∞–¥ –∫ –¥—Ä—É–∑—å—è–º</button>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –°–∫–∏–Ω—ã -->
            <div id="skinsContent" class="community-content">
                <div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ —Å–∫–∏–Ω</div>
                <div class="skins-grid" id="skinsGrid">
                    <!-- –°–∫–∏–Ω—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDy85tU19HazMv8iY8MVqtbwzDvoyklFVY",
            authDomain: "ggff-a00c0.firebaseapp.com",
            databaseURL: "https://ggff-a00c0-default-rtdb.firebaseio.com",
            projectId: "ggff-a00c0",
            storageBucket: "ggff-a00c0.firebasestorage.app",
            messagingSenderId: "470803077698",
            appId: "1:470803077698:web:05ebb08c0a444df3176bdb"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let currentGameId = null;
        let playerSymbol = null;
        let isMyTurn = false;
        let gameRef = null;
        let lobbiesRef = null;
        let autoStart = true;
        let boardSize = 3;
        let winLength = 3;
        let gameMode = 'online';
        let botDifficulty = 'easy';
        let playersCount = 2;
        let currentGameData = null;

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∞–∫–∫–∞—É–Ω—Ç–æ–≤
        let currentUser = null;
        let isLoggedIn = false;

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –¥—Ä—É–∑–µ–π
        let friendsRef = null;
        let usersRef = null;
        let friendRequestsRef = null;

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
        let currentInvite = null;
        let invitesRef = null;

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
        let sentInvitesRef = null;
        let sentInvites = {};

        // –°–∏–º–≤–æ–ª—ã –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤
        const playerSymbols = {
            1: { symbol: 'X', name: '–ö—Ä–µ—Å—Ç–∏–∫', emoji: '‚ùå', class: 'x' },
            2: { symbol: 'O', name: '–ù–æ–ª–∏–∫', emoji: '‚≠ï', class: 'o' },
            3: { symbol: '‚ñ≥', name: '–¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫', emoji: 'üü•', class: 'triangle' },
            4: { symbol: '‚óá', name: '–†–æ–º–±', emoji: 'üî¥', class: 'diamond' }
        };

        // –°–∫–∏–Ω—ã
        const availableSkins = [
            { id: 'classic', name: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π', emoji: 'üéÆ', price: 0, owned: true },
            { id: 'space', name: '–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π', emoji: 'üöÄ', price: 100, owned: false },
            { id: 'ocean', name: '–û–∫–µ–∞–Ω', emoji: 'üåä', price: 150, owned: false },
            { id: 'forest', name: '–õ–µ—Å', emoji: 'üå≤', price: 120, owned: false },
            { id: 'fire', name: '–û–≥–Ω–µ–Ω–Ω—ã–π', emoji: 'üî•', price: 200, owned: false },
            { id: 'ice', name: '–õ–µ–¥—è–Ω–æ–π', emoji: '‚ùÑÔ∏è', price: 180, owned: false }
        ];

        // –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –°–¢–ê–¢–£–°–ê –û–ù–õ–ê–ô–ù
        function updateOnlineStatus() {
            if (!isLoggedIn || !currentUser) return;
            
            const userRef = database.ref('users/' + currentUser.id);
            const onlineUntil = Date.now() + 2 * 60 * 1000; // 2 –º–∏–Ω—É—Ç—ã
            
            userRef.update({
                lastOnline: Date.now(),
                onlineUntil: onlineUntil
            }).catch(error => {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', error);
            });
        }

        // –û–ë–†–ê–ë–û–¢–ß–ò–ö –õ–Æ–ë–û–ô –ö–ù–û–ü–ö–ò –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –°–¢–ê–¢–£–°–ê
        function setupButtonHandlers() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.addEventListener('click', function(e) {
                if (e.target.tagName === 'BUTTON' && isLoggedIn) {
                    updateOnlineStatus();
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
            document.addEventListener('input', function(e) {
                if ((e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') && isLoggedIn) {
                    updateOnlineStatus();
                }
            });
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –£–í–ï–î–û–ú–õ–ï–ù–ò–ô –û –ü–†–ò–ì–õ–ê–®–ï–ù–ò–Ø–•
        function setupInviteListener() {
            if (!isLoggedIn || !currentUser) return;
            
            invitesRef = database.ref('gameInvites/' + currentUser.id);
            
            invitesRef.on('child_added', (snapshot) => {
                const invite = snapshot.val();
                const inviteId = snapshot.key;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–∏
                showInviteNotification(invite, inviteId);
            });
        }

        function showInviteNotification(invite, inviteId) {
            const notification = document.getElementById('inviteNotification');
            const inviteText = document.getElementById('inviteText');
            
            inviteText.textContent = `${invite.fromUsername} –ø—Ä–∏–≥–ª–∞—à–∞–µ—Ç –≤–∞—Å –≤ –ª–æ–±–±–∏!`;
            currentInvite = { ...invite, id: inviteId };
            
            notification.classList.add('show');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                if (notification.classList.contains('show')) {
                    declineInvite();
                }
            }, 30000);
        }

        function hideInviteNotification() {
            const notification = document.getElementById('inviteNotification');
            notification.classList.remove('show');
            currentInvite = null;
        }

        function acceptInvite() {
            if (!currentInvite) return;
            
            console.log('–ü—Ä–∏–Ω–∏–º–∞–µ–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ –ª–æ–±–±–∏:', currentInvite.gameId);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º gameId –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
            const gameIdToJoin = currentInvite.gameId;
            const fromUsername = currentInvite.fromUsername;
            
            // –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –∏ —Å–∫—Ä—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const inviteRef = database.ref('gameInvites/' + currentUser.id + '/' + currentInvite.id);
            inviteRef.remove().then(() => {
                console.log('–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ, –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—Å—è –∫ –ª–æ–±–±–∏');
                hideInviteNotification();
                
                // –ó–∞—Ç–µ–º –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—Å—è –∫ –ª–æ–±–±–∏
                joinLobby(gameIdToJoin);
            }).catch(error => {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è:', error);
                hideInviteNotification();
                joinLobby(gameIdToJoin);
            });
        }

        function declineInvite() {
            if (!currentInvite) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è —É –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
            const sentInviteRef = database.ref('sentInvites/' + currentInvite.fromUserId);
            
            // –ù–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
            sentInviteRef.once('value').then(snapshot => {
                const invites = snapshot.val();
                if (invites) {
                    Object.keys(invites).forEach(inviteId => {
                        const invite = invites[inviteId];
                        if (invite.toUserId === currentUser.id && invite.gameId === currentInvite.gameId) {
                            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ "declined"
                            sentInviteRef.child(inviteId).update({
                                status: 'declined',
                                declinedAt: Date.now()
                            });
                        }
                    });
                }
            });
            
            // –£–¥–∞–ª—è–µ–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —É –ø–æ–ª—É—á–∞—Ç–µ–ª—è
            const inviteRef = database.ref('gameInvites/' + currentUser.id + '/' + currentInvite.id);
            inviteRef.remove();
            
            hideInviteNotification();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            alert('–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ');
        }

        // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
        document.getElementById('acceptInvite').addEventListener('click', acceptInvite);
        document.getElementById('declineInvite').addEventListener('click', declineInvite);

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –°–ò–°–¢–ï–ú–´ –ê–ö–ö–ê–£–ù–¢–û–í
        function showAccountModal() {
            document.getElementById('accountModal').classList.add('active');
            updateAccountUI();
        }

        function hideAccountModal() {
            document.getElementById('accountModal').classList.remove('active');
        }

        function updateAccountUI() {
            const accountBtn = document.getElementById('accountBtn');
            
            if (isLoggedIn && currentUser) {
                accountBtn.textContent = `üë§ ${currentUser.username}`;
                document.getElementById('currentUsername').textContent = currentUser.username;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é –∞–∫–∫–∞—É–Ω—Ç–∞
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('registerForm').classList.add('hidden');
                document.getElementById('accountSettings').classList.add('hidden');
                document.getElementById('accountMenu').classList.remove('hidden');
            } else {
                accountBtn.textContent = 'üë§ –ê–∫–∫–∞—É–Ω—Ç';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞
                document.getElementById('loginForm').classList.remove('hidden');
                document.getElementById('registerForm').classList.add('hidden');
                document.getElementById('accountSettings').classList.add('hidden');
                document.getElementById('accountMenu').classList.add('hidden');
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –∏ –æ—à–∏–±–∫–∏
                clearAccountForms();
            }
        }

        function clearAccountForms() {
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
            document.getElementById('registerUsername').value = '';
            document.getElementById('registerPassword').value = '';
            document.getElementById('registerConfirmPassword').value = '';
            document.getElementById('newUsername').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('newConfirmPassword').value = '';
            
            document.getElementById('loginError').textContent = '';
            document.getElementById('registerError').textContent = '';
            document.getElementById('registerSuccess').textContent = '';
            document.getElementById('settingsError').textContent = '';
            document.getElementById('settingsSuccess').textContent = '';
        }

        function registerUser(username, password) {
            const usersRef = database.ref('users');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º
            usersRef.orderByChild('username').equalTo(username).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        document.getElementById('registerError').textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
                    } else {
                        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID –∏–∑ 4 —Ü–∏—Ñ—Ä
                        const userId = generateUserId();
                        
                        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        const userData = {
                            id: userId,
                            username: username,
                            password: password,
                            skin: 'classic',
                            lastOnline: Date.now(),
                            onlineUntil: Date.now() + 2 * 60 * 1000, // 2 –º–∏–Ω—É—Ç—ã
                            createdAt: Date.now()
                        };
                        
                        usersRef.child(userId).set(userData)
                            .then(() => {
                                document.getElementById('registerSuccess').textContent = '–ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏.';
                                document.getElementById('registerError').textContent = '';
                                
                                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞
                                document.getElementById('registerForm').classList.add('hidden');
                                document.getElementById('loginForm').classList.remove('hidden');
                            })
                            .catch(error => {
                                document.getElementById('registerError').textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞: ' + error.message;
                            });
                    }
                })
                .catch(error => {
                    document.getElementById('registerError').textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ' + error.message;
                });
        }

        function generateUserId() {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 4-–∑–Ω–∞—á–Ω—ã–π ID
            return Math.floor(1000 + Math.random() * 9000).toString();
        }

        function loginUser(username, password) {
            const usersRef = database.ref('users');
            
            usersRef.orderByChild('username').equalTo(username).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        let userFound = false;
                        snapshot.forEach(childSnapshot => {
                            const user = childSnapshot.val();
                            if (user.password === password) {
                                userFound = true;
                                currentUser = user;
                                isLoggedIn = true;
                                
                                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ö–æ–¥–∞
                                const onlineUntil = Date.now() + 2 * 60 * 1000;
                                usersRef.child(user.id).update({
                                    lastOnline: Date.now(),
                                    onlineUntil: onlineUntil
                                });
                                
                                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                                localStorage.setItem('xo_currentUser', JSON.stringify(user));
                                
                                updateAccountUI();
                                hideAccountModal();
                                
                                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –∏–≥—Ä—ã
                                updateGameButtons();
                                
                                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥—Ä—É–∑–µ–π –∏ —Å–∫–∏–Ω—ã
                                loadFriends();
                                loadSkins();
                                
                                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
                                setupInviteListener();
                                setupSentInvitesListener();
                                return;
                            }
                        });
                        
                        if (!userFound) {
                            document.getElementById('loginError').textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
                        }
                    } else {
                        document.getElementById('loginError').textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º –Ω–µ –Ω–∞–π–¥–µ–Ω';
                    }
                })
                .catch(error => {
                    document.getElementById('loginError').textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ: ' + error.message;
                });
        }

        function logoutUser() {
            currentUser = null;
            isLoggedIn = false;
            localStorage.removeItem('xo_currentUser');
            updateAccountUI();
            hideAccountModal();
            updateGameButtons();
            
            // –û—Ç–∫–ª—é—á–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
            if (invitesRef) {
                invitesRef.off();
            }
            if (sentInvitesRef) {
                sentInvitesRef.off();
            }
        }

        function updateUserSettings(newUsername, newPassword) {
            if (!currentUser) return;
            
            const userRef = database.ref('users/' + currentUser.id);
            const updates = {};
            
            if (newUsername && newUsername !== currentUser.username) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–Ω—è—Ç–æ –ª–∏ –Ω–æ–≤–æ–µ –∏–º—è
                const usersRef = database.ref('users');
                usersRef.orderByChild('username').equalTo(newUsername).once('value')
                    .then(snapshot => {
                        if (snapshot.exists()) {
                            document.getElementById('settingsError').textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
                        } else {
                            updates.username = newUsername;
                            saveUserUpdates(updates, newPassword);
                        }
                    })
                    .catch(error => {
                        document.getElementById('settingsError').textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∏–º–µ–Ω–∏: ' + error.message;
                    });
            } else {
                saveUserUpdates(updates, newPassword);
            }
        }

        function saveUserUpdates(updates, newPassword) {
            if (newPassword) {
                updates.password = newPassword;
            }
            
            if (Object.keys(updates).length > 0) {
                const userRef = database.ref('users/' + currentUser.id);
                userRef.update(updates)
                    .then(() => {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        if (updates.username) {
                            currentUser.username = updates.username;
                        }
                        if (newPassword) {
                            currentUser.password = newPassword;
                        }
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                        localStorage.setItem('xo_currentUser', JSON.stringify(currentUser));
                        
                        document.getElementById('settingsSuccess').textContent = '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!';
                        document.getElementById('settingsError').textContent = '';
                        
                        updateAccountUI();
                    })
                    .catch(error => {
                        document.getElementById('settingsError').textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫: ' + error.message;
                    });
            } else {
                document.getElementById('settingsError').textContent = '–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è';
            }
        }

        function updateGameButtons() {
            const quickPlayBtn = document.getElementById('quickPlay');
            const createGameBtn = document.getElementById('createGame');
            const showLobbiesBtn = document.getElementById('showLobbies');
            
            if (isLoggedIn) {
                quickPlayBtn.disabled = false;
                createGameBtn.disabled = false;
                showLobbiesBtn.disabled = false;
            } else {
                quickPlayBtn.disabled = true;
                createGameBtn.disabled = true;
                showLobbiesBtn.disabled = true;
            }
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –°–ò–°–¢–ï–ú–´ –î–†–£–ó–ï–ô
        function loadFriends() {
            if (!isLoggedIn) return;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π
            friendsRef = database.ref('friends/' + currentUser.id);
            friendsRef.on('value', (snapshot) => {
                const friends = snapshot.val();
                renderFriendsList(friends);
            });
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞—è–≤–∫–∏ –≤ –¥—Ä—É–∑—å—è
            friendRequestsRef = database.ref('friendRequests/' + currentUser.id);
            friendRequestsRef.on('value', (snapshot) => {
                const requests = snapshot.val();
                renderFriendRequests(requests);
            });
        }

        function renderFriendsList(friends) {
            const friendsList = document.getElementById('friendsList');
            
            if (!friends || Object.keys(friends).length === 0) {
                friendsList.innerHTML = '<div class="empty-state" style="text-align: center; padding: 40px; color: #7f8c8d;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π</div>';
                return;
            }
            
            friendsList.innerHTML = '';
            
            // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º –¥—Ä—É–≥–µ
            const userPromises = Object.keys(friends).map(friendId => {
                return database.ref('users/' + friendId).once('value');
            });
            
            Promise.all(userPromises).then(snapshots => {
                snapshots.forEach(snapshot => {
                    if (snapshot.exists()) {
                        const friend = snapshot.val();
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Å–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                        if (friend.id !== currentUser.id) {
                            const friendItem = createFriendItem(friend);
                            friendsList.appendChild(friendItem);
                        }
                    }
                });
            });
        }

        function createFriendItem(friend) {
            const friendItem = document.createElement('div');
            friendItem.className = 'friend-item';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –¥—Ä—É–≥–∞
            let status = getFriendStatus(friend);
            let statusText = '';
            let statusClass = '';
            
            if (status === 'online') {
                statusText = '–í —Å–µ—Ç–∏';
                statusClass = 'status-online';
            } else if (status === 'ingame') {
                statusText = '–í –∏–≥—Ä–µ';
                statusClass = 'status-ingame';
            } else {
                statusText = getTimeAgo(friend.lastOnline);
                statusClass = 'status-offline';
            }
            
            friendItem.innerHTML = `
                <div class="friend-info">
                    <div class="friend-avatar">${friend.username.charAt(0).toUpperCase()}</div>
                    <div class="friend-details">
                        <div class="friend-name">${friend.username} #${friend.id}</div>
                        <div class="friend-status ${statusClass}">${statusText}</div>
                    </div>
                </div>
                <div class="friend-actions">
                    <button class="friend-btn btn-invite" data-friend-id="${friend.id}">
                        üéÆ –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å
                    </button>
                    <button class="friend-btn btn-remove" data-friend-id="${friend.id}" title="–£–¥–∞–ª–∏—Ç—å –∏–∑ –¥—Ä—É–∑–µ–π">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
            `;
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
            friendItem.querySelector('.btn-invite').addEventListener('click', function() {
                inviteFriendToLobby(friend.id);
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è
            friendItem.querySelector('.btn-remove').addEventListener('click', function() {
                removeFriend(friend.id, friend.username);
            });
            
            return friendItem;
        }

        function removeFriend(friendId, friendUsername) {
            if (!isLoggedIn || !confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å ${friendUsername} –∏–∑ –¥—Ä—É–∑–µ–π?`)) {
                return;
            }
            
            // –£–¥–∞–ª—è–µ–º –¥—Ä—É–≥–∞ —É —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userFriendRef = database.ref('friends/' + currentUser.id + '/' + friendId);
            // –£–¥–∞–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É –¥—Ä—É–≥–∞
            const friendUserRef = database.ref('friends/' + friendId + '/' + currentUser.id);
            
            Promise.all([
                userFriendRef.remove(),
                friendUserRef.remove()
            ]).then(() => {
                alert(`${friendUsername} —É–¥–∞–ª–µ–Ω –∏–∑ –¥—Ä—É–∑–µ–π!`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π
                loadFriends();
                
                // –¢–∞–∫–∂–µ —É–¥–∞–ª—è–µ–º –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
                cleanupFriendInvites(friendId);
                
            }).catch(error => {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –¥—Ä—É–≥–∞: ' + error.message);
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥—Ä—É–≥–∞:', error);
            });
        }

        function cleanupFriendInvites(friendId) {
            if (!isLoggedIn) return;
            
            // –û—á–∏—â–∞–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è —ç—Ç–æ–º—É –¥—Ä—É–≥—É
            const sentInviteRef = database.ref('sentInvites/' + currentUser.id);
            sentInviteRef.once('value').then(snapshot => {
                const invites = snapshot.val();
                if (invites) {
                    Object.keys(invites).forEach(inviteId => {
                        const invite = invites[inviteId];
                        if (invite.toUserId === friendId) {
                            sentInviteRef.child(inviteId).remove();
                        }
                    });
                }
            });
            
            // –û—á–∏—â–∞–µ–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –æ—Ç —ç—Ç–æ–≥–æ –¥—Ä—É–≥–∞
            const receivedInviteRef = database.ref('gameInvites/' + currentUser.id);
            receivedInviteRef.once('value').then(snapshot => {
                const invites = snapshot.val();
                if (invites) {
                    Object.keys(invites).forEach(inviteId => {
                        const invite = invites[inviteId];
                        if (invite.fromUserId === friendId) {
                            receivedInviteRef.child(inviteId).remove();
                        }
                    });
                }
            });
            
            // –û—á–∏—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à
            if (sentInvites[friendId]) {
                delete sentInvites[friendId];
            }
        }

        function getFriendStatus(friend) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å –ø–æ onlineUntil
            if (friend.onlineUntil && Date.now() < friend.onlineUntil) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –¥—Ä—É–≥ –≤ –∏–≥—Ä–µ
                // –≠—Ç–æ —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∏–≥—Ä—ã
                if (Math.random() > 0.7) { // –°–ª—É—á–∞–π–Ω—ã–π —Å—Ç–∞—Ç—É—Å –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
                    return 'ingame';
                } else {
                    return 'online';
                }
            } else {
                return 'offline';
            }
        }

        function getTimeAgo(timestamp) {
            if (!timestamp) return '–Ω–∏–∫–æ–≥–¥–∞';
            
            const timeDiff = Date.now() - timestamp;
            const seconds = Math.floor(timeDiff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (days > 7) {
                const date = new Date(timestamp);
                return date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });
            } else if (days > 0) {
                return `${days} ${getRussianDays(days)} –Ω–∞–∑–∞–¥`;
            } else if (hours > 0) {
                return `${hours} ${getRussianHours(hours)} –Ω–∞–∑–∞–¥`;
            } else if (minutes > 0) {
                return `${minutes} ${getRussianMinutes(minutes)} –Ω–∞–∑–∞–¥`;
            } else {
                return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
        function getRussianDays(days) {
            if (days === 1) return '–¥–µ–Ω—å';
            if (days >= 2 && days <= 4) return '–¥–Ω—è';
            return '–¥–Ω–µ–π';
        }

        function getRussianHours(hours) {
            if (hours === 1) return '—á–∞—Å';
            if (hours >= 2 && hours <= 4) return '—á–∞—Å–∞';
            return '—á–∞—Å–æ–≤';
        }

        function getRussianMinutes(minutes) {
            if (minutes === 1) return '–º–∏–Ω—É—Ç—É';
            if (minutes >= 2 && minutes <= 4) return '–º–∏–Ω—É—Ç—ã';
            return '–º–∏–Ω—É—Ç';
        }

        function renderFriendRequests(requests) {
            const requestsList = document.getElementById('friendRequestsList');
            
            if (!requests || Object.keys(requests).length === 0) {
                requestsList.innerHTML = '<div class="empty-state" style="text-align: center; padding: 40px; color: #7f8c8d;">–ù–µ—Ç –∑–∞—è–≤–æ–∫ –≤ –¥—Ä—É–∑—å—è</div>';
                return;
            }
            
            requestsList.innerHTML = '';
            
            // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ –∑–∞—è–≤–∫–∏
            const userPromises = Object.keys(requests).map(senderId => {
                return database.ref('users/' + senderId).once('value');
            });
            
            Promise.all(userPromises).then(snapshots => {
                snapshots.forEach(snapshot => {
                    if (snapshot.exists()) {
                        const sender = snapshot.val();
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Å–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                        if (sender.id !== currentUser.id) {
                            const requestItem = createFriendRequestItem(sender);
                            requestsList.appendChild(requestItem);
                        }
                    }
                });
            });
        }

        function createFriendRequestItem(sender) {
            const requestItem = document.createElement('div');
            requestItem.className = 'request-item';
            
            requestItem.innerHTML = `
                <div class="request-info">
                    <div class="friend-avatar">${sender.username.charAt(0).toUpperCase()}</div>
                    <div class="friend-details">
                        <div class="friend-name">${sender.username} #${sender.id}</div>
                        <div class="friend-status">–•–æ—á–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≤–∞—Å –≤ –¥—Ä—É–∑—å—è</div>
                    </div>
                </div>
                <div class="request-actions">
                    <button class="request-btn btn-accept" data-sender-id="${sender.id}">–ü—Ä–∏–Ω—è—Ç—å</button>
                    <button class="request-btn btn-decline" data-sender-id="${sender.id}">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                </div>
            `;
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
            requestItem.querySelector('.btn-accept').addEventListener('click', function() {
                acceptFriendRequest(sender.id);
            });
            
            requestItem.querySelector('.btn-decline').addEventListener('click', function() {
                declineFriendRequest(sender.id);
            });
            
            return requestItem;
        }

        function acceptFriendRequest(senderId) {
            if (!isLoggedIn) return;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –¥—Ä—É–∑—å—è
            const userFriendRef = database.ref('friends/' + currentUser.id + '/' + senderId);
            const senderFriendRef = database.ref('friends/' + senderId + '/' + currentUser.id);
            
            Promise.all([
                userFriendRef.set({ timestamp: Date.now() }),
                senderFriendRef.set({ timestamp: Date.now() })
            ]).then(() => {
                // –£–¥–∞–ª—è–µ–º –∑–∞—è–≤–∫—É
                const requestRef = database.ref('friendRequests/' + currentUser.id + '/' + senderId);
                return requestRef.remove();
            }).then(() => {
                alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω –≤ –¥—Ä—É–∑—å—è!');
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
                setTimeout(() => {
                    loadFriends();
                }, 500);
            }).catch(error => {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –¥—Ä—É–∑—å—è: ' + error.message);
            });
        }

        function declineFriendRequest(senderId) {
            if (!isLoggedIn) return;
            
            const requestRef = database.ref('friendRequests/' + currentUser.id + '/' + senderId);
            requestRef.remove()
                .then(() => {
                    alert('–ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞');
                })
                .catch(error => {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏: ' + error.message);
                });
        }

        function loadAllUsers() {
            if (!isLoggedIn) return;
            
            usersRef = database.ref('users');
            usersRef.once('value').then(snapshot => {
                const users = snapshot.val();
                renderAllUsers(users);
            });
        }

        function renderAllUsers(users) {
            const allUsersList = document.getElementById('allUsersList');
            
            if (!users || Object.keys(users).length === 0) {
                allUsersList.innerHTML = '<div class="empty-state" style="text-align: center; padding: 40px; color: #7f8c8d;">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>';
                return;
            }
            
            allUsersList.innerHTML = '';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            friendsRef.once('value').then(friendsSnapshot => {
                const friends = friendsSnapshot.val() || {};
                
                Object.keys(users).forEach(userId => {
                    const user = users[userId];
                    // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –¥—Ä—É–∑–µ–π
                    if (user.id !== currentUser.id && !friends[user.id]) {
                        const userItem = createUserItem(user);
                        allUsersList.appendChild(userItem);
                    }
                });
            });
        }

        function createUserItem(user) {
            const userItem = document.createElement('div');
            userItem.className = 'user-item';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            let status = getFriendStatus(user);
            let statusText = '';
            let statusClass = '';
            
            if (status === 'online') {
                statusText = '–í —Å–µ—Ç–∏';
                statusClass = 'status-online';
            } else if (status === 'ingame') {
                statusText = '–í –∏–≥—Ä–µ';
                statusClass = 'status-ingame';
            } else {
                statusText = getTimeAgo(user.lastOnline);
                statusClass = 'status-offline';
            }
            
            userItem.innerHTML = `
                <div class="user-info">
                    <div class="user-avatar">${user.username.charAt(0).toUpperCase()}</div>
                    <div class="user-details">
                        <div class="user-name">${user.username} #${user.id}</div>
                        <div class="user-status ${statusClass}">${statusText}</div>
                    </div>
                </div>
                <div class="user-actions">
                    <button class="user-btn btn-add" data-user-id="${user.id}">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
            `;
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –¥—Ä—É–∑—å—è
            userItem.querySelector('.btn-add').addEventListener('click', function() {
                sendFriendRequest(user.id);
            });
            
            return userItem;
        }

        function sendFriendRequest(friendId) {
            if (!isLoggedIn) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ª–∏ –∑–∞—è–≤–∫—É —Å–∞–º–æ–º—É —Å–µ–±–µ
            if (friendId === currentUser.id) {
                alert('–ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è –≤ –¥—Ä—É–∑—å—è!');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ –ª–∏ —É–∂–µ –∑–∞—è–≤–∫—É —ç—Ç–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            const requestRef = database.ref('friendRequests/' + friendId + '/' + currentUser.id);
            requestRef.once('value').then(snapshot => {
                if (snapshot.exists()) {
                    alert('–í—ã —É–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –∑–∞—è–≤–∫—É —ç—Ç–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é!');
                    return;
                }
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞—è–≤–∫—É
                requestRef.set({
                    timestamp: Date.now()
                }).then(() => {
                    alert('–ó–∞—è–≤–∫–∞ –≤ –¥—Ä—É–∑—å—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!');
                }).catch(error => {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏: ' + error.message);
                });
            });
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –°–ö–ò–ù–û–í
        function loadSkins() {
            const skinsGrid = document.getElementById('skinsGrid');
            skinsGrid.innerHTML = '';
            
            availableSkins.forEach(skin => {
                const skinItem = document.createElement('div');
                skinItem.className = `skin-item ${skin.owned ? 'owned' : ''} ${currentUser && currentUser.skin === skin.id ? 'selected' : ''}`;
                
                skinItem.innerHTML = `
                    <div class="skin-preview">${skin.emoji}</div>
                    <div class="skin-name">${skin.name}</div>
                    <div class="skin-price">${skin.owned ? '<span class="skin-owned">‚úì –í–ª–∞–¥–µ–µ—Ç–µ</span>' : '–¶–µ–Ω–∞: ' + skin.price + ' –º–æ–Ω–µ—Ç'}</div>
                `;
                
                if (skin.owned || skin.price === 0) {
                    skinItem.addEventListener('click', function() {
                        selectSkin(skin.id);
                    });
                }
                
                skinsGrid.appendChild(skinItem);
            });
        }

        function selectSkin(skinId) {
            if (!isLoggedIn) return;
            
            const userRef = database.ref('users/' + currentUser.id);
            userRef.update({
                skin: skinId
            }).then(() => {
                currentUser.skin = skinId;
                localStorage.setItem('xo_currentUser', JSON.stringify(currentUser));
                loadSkins();
            }).catch(error => {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Å–∫–∏–Ω–∞: ' + error.message);
            });
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ü–†–ò–ì–õ–ê–®–ï–ù–ò–Ø –î–†–£–ó–ï–ô –í –õ–û–ë–ë–ò
        function showInviteFriendsPanel() {
            const inviteSection = document.getElementById('inviteFriendsSection');
            inviteSection.classList.remove('hidden');
            loadFriendsForInvite();
        }

        function hideInviteFriendsPanel() {
            const inviteSection = document.getElementById('inviteFriendsSection');
            inviteSection.classList.add('hidden');
        }

        function loadFriendsForInvite() {
            if (!isLoggedIn || !friendsRef) return;
            
            friendsRef.once('value').then(snapshot => {
                const friends = snapshot.val();
                renderFriendsForInvite(friends);
            });
        }

        function renderFriendsForInvite(friends) {
            const inviteList = document.getElementById('inviteFriendsList');
            
            if (!friends || Object.keys(friends).length === 0) {
                inviteList.innerHTML = '<div class="empty-state" style="text-align: center; padding: 20px; color: #7f8c8d;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</div>';
                return;
            }
            
            inviteList.innerHTML = '';
            
            // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º –¥—Ä—É–≥–µ
            const userPromises = Object.keys(friends).map(friendId => {
                return database.ref('users/' + friendId).once('value');
            });
            
            Promise.all(userPromises).then(snapshots => {
                snapshots.forEach(snapshot => {
                    if (snapshot.exists()) {
                        const friend = snapshot.val();
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Å–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                        if (friend.id !== currentUser.id) {
                            const inviteItem = createInviteItem(friend);
                            inviteList.appendChild(inviteItem);
                        }
                    }
                });
            });
        }

        function createInviteItem(friend) {
            const inviteItem = document.createElement('div');
            inviteItem.className = 'invite-item';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
            const sentInvite = sentInvites[friend.id];
            const isInviteSent = sentInvite && sentInvite.status === 'pending';
            const isInviteDeclined = sentInvite && sentInvite.status === 'declined';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –æ–Ω–ª–∞–π–Ω
            const lastOnline = getTimeAgo(friend.lastOnline);
            const isOnline = getFriendStatus(friend) === 'online';
            const isInGame = getFriendStatus(friend) === 'ingame';
            
            let statusText = '';
            let statusClass = '';
            
            if (isOnline) {
                statusText = 'üü¢ –í —Å–µ—Ç–∏';
                statusClass = 'status-online';
            } else if (isInGame) {
                statusText = 'üéÆ –í –∏–≥—Ä–µ';
                statusClass = 'status-ingame';
            } else {
                statusText = `‚ö´ –ë—ã–ª(–∞) ${lastOnline}`;
                statusClass = 'status-offline';
            }
            
            let buttonText = '–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å';
            let buttonClass = 'invite-btn';
            let isDisabled = false;
            
            if (isInviteSent) {
                buttonText = '‚úì –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ';
                buttonClass = 'invite-btn-sent';
                isDisabled = true;
            } else if (isInviteDeclined) {
                buttonText = '–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å';
                buttonClass = 'invite-btn';
            }
            
            // –ï—Å–ª–∏ –¥—Ä—É–≥ –æ—Ñ—Ñ–ª–∞–π–Ω, –¥–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π
            if (!isOnline && !isInGame && !isInviteSent) {
                buttonText = '–û—Ñ—Ñ–ª–∞–π–Ω';
                buttonClass = 'invite-btn-offline';
                isDisabled = true;
            }
            
            inviteItem.innerHTML = `
                <div class="invite-info">
                    <div class="invite-avatar">${friend.username.charAt(0).toUpperCase()}</div>
                    <div class="invite-details">
                        <div class="friend-name">${friend.username} #${friend.id}</div>
                        <div class="friend-status ${statusClass}">${statusText}</div>
                    </div>
                </div>
                <div class="invite-action">
                    <button class="${buttonClass}" ${isDisabled ? 'disabled' : ''}>
                        ${buttonText}
                    </button>
                    ${isInviteDeclined ? '<div class="decline-message">–ò–≥—Ä–æ–∫ –æ—Ç–∫–ª–æ–Ω–∏–ª –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</div>' : ''}
                </div>
            `;
            
            if (!isDisabled && !isInviteSent) {
                inviteItem.querySelector('button').addEventListener('click', function() {
                    inviteFriendToLobby(friend.id);
                });
            }
            
            return inviteItem;
        }

        function inviteFriendToLobby(friendId) {
            if (!currentGameId || !isLoggedIn) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—Ä–∏–≥–ª–∞—à–∞–µ–º –ª–∏ —Å–∞–º–æ–≥–æ —Å–µ–±—è
            if (friendId === currentUser.id) {
                alert('–ù–µ–ª—å–∑—è –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è!');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –ª–∏ —É–∂–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
            if (sentInvites[friendId]) {
                alert('–í—ã —É–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —ç—Ç–æ–º—É –∏–≥—Ä–æ–∫—É!');
                return;
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥—Ä—É–≥—É
            const inviteRef = database.ref('gameInvites/' + friendId).push();
            const inviteId = inviteRef.key;
            
            inviteRef.set({
                fromUserId: currentUser.id,
                fromUsername: currentUser.username,
                gameId: currentGameId,
                timestamp: Date.now(),
                status: 'pending' // –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
            }).then(() => {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–∏
                const sentInviteRef = database.ref('sentInvites/' + currentUser.id + '/' + inviteId);
                sentInviteRef.set({
                    toUserId: friendId,
                    gameId: currentGameId,
                    timestamp: Date.now(),
                    status: 'pending'
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à
                sentInvites[friendId] = {
                    inviteId: inviteId,
                    status: 'pending',
                    timestamp: Date.now()
                };
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
                loadFriendsForInvite();
                
                alert('–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
            }).catch(error => {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è: ' + error.message);
            });
        }

        function setupSentInvitesListener() {
            if (!isLoggedIn || !currentUser) return;
            
            sentInvitesRef = database.ref('sentInvites/' + currentUser.id);
            
            sentInvitesRef.on('value', (snapshot) => {
                const invites = snapshot.val();
                sentInvites = {};
                
                if (invites) {
                    Object.keys(invites).forEach(inviteId => {
                        const invite = invites[inviteId];
                        sentInvites[invite.toUserId] = {
                            inviteId: inviteId,
                            status: invite.status,
                            timestamp: invite.timestamp
                        };
                    });
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤
                loadFriendsForInvite();
            });
        }

        // –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –≠–ö–†–ê–ù–û–í
        function showScreen(screenToShow) {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('lobbyListSection').classList.add('hidden');
            document.getElementById('createLobbySection').classList.add('hidden');
            document.getElementById('gameSection').classList.add('hidden');
            document.getElementById(screenToShow).classList.remove('hidden');
            
            // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–≥—Ä—ã
            document.querySelector('.game-container').classList.remove('game-section-active');
            
            // –ï—Å–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω, —Å–∫—Ä—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫–∏
            if (screenToShow === 'gameSection') {
                document.querySelector('.game-container').classList.add('game-section-active');
            }
        }

        // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–ò–°–¢–ï–ú–´ –ê–ö–ö–ê–£–ù–¢–û–í
        document.getElementById('accountBtn').addEventListener('click', showAccountModal);

        document.getElementById('accountModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideAccountModal();
            }
        });

        document.getElementById('showRegisterBtn').addEventListener('click', function() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            clearAccountForms();
        });

        document.getElementById('showLoginBtn').addEventListener('click', function() {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            clearAccountForms();
        });

        document.getElementById('registerBtn').addEventListener('click', function() {
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            if (!username || !password) {
                document.getElementById('registerError').textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
                return;
            }
            
            if (password !== confirmPassword) {
                document.getElementById('registerError').textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
                return;
            }
            
            if (password.length < 4) {
                document.getElementById('registerError').textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞';
                return;
            }
            
            registerUser(username, password);
        });

        document.getElementById('loginBtn').addEventListener('click', function() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                document.getElementById('loginError').textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
                return;
            }
            
            loginUser(username, password);
        });

        document.getElementById('accountSettingsBtn').addEventListener('click', function() {
            document.getElementById('accountMenu').classList.add('hidden');
            document.getElementById('accountSettings').classList.remove('hidden');
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
            document.getElementById('newUsername').value = currentUser.username;
        });

        document.getElementById('backToAccountBtn').addEventListener('click', function() {
            document.getElementById('accountSettings').classList.add('hidden');
            document.getElementById('accountMenu').classList.remove('hidden');
            clearAccountForms();
        });

        document.getElementById('saveSettingsBtn').addEventListener('click', function() {
            const newUsername = document.getElementById('newUsername').value.trim();
            const newPassword = document.getElementById('newPassword').value;
            const newConfirmPassword = document.getElementById('newConfirmPassword').value;
            
            if (newPassword && newPassword !== newConfirmPassword) {
                document.getElementById('settingsError').textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
                return;
            }
            
            if (newPassword && newPassword.length < 4) {
                document.getElementById('settingsError').textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞';
                return;
            }
            
            updateUserSettings(newUsername, newPassword);
        });

        document.getElementById('logoutBtn').addEventListener('click', logoutUser);

        // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –í–ö–õ–ê–î–û–ö –°–û–û–ë–©–ï–°–¢–í–ê
        document.querySelectorAll('.community-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
                document.querySelectorAll('.community-tab').forEach(t => t.classList.remove('active'));
                // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–µ
                this.classList.add('active');
                
                const tabName = this.dataset.communityTab;
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
                document.querySelectorAll('.community-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                document.getElementById(tabName + 'Content').classList.add('active');
            });
        });

        // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –î–†–£–ó–ï–ô
        document.getElementById('addFriendBtn').addEventListener('click', function() {
            document.getElementById('friendsContent').classList.add('hidden');
            document.getElementById('allUsersSection').classList.remove('hidden');
            loadAllUsers();
        });

        document.getElementById('backToFriendsBtn').addEventListener('click', function() {
            document.getElementById('allUsersSection').classList.add('hidden');
            document.getElementById('friendsContent').classList.remove('hidden');
        });

        // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–ù–û–ü–û–ö –ò–ì–†–´
        document.getElementById('quickPlay').onclick = function() {
            console.log('–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–ë—ã—Å—Ç—Ä–∞—è –∏–≥—Ä–∞"');
            // –§—É–Ω–∫—Ü–∏—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–ª—É—á–∞–π–Ω–æ–º—É –ª–æ–±–±–∏
            quickJoin();
        };

        document.getElementById('createGame').onclick = function() {
            console.log('–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –ª–æ–±–±–∏"');
            showScreen('createLobbySection');
        };

        document.getElementById('showLobbies').onclick = function() {
            console.log('–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤"');
            showScreen('lobbyListSection');
            loadLobbies();
        };

        document.getElementById('backToMain').onclick = function() {
            console.log('–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"');
            showScreen('mainMenu');
            if (lobbiesRef) {
                lobbiesRef.off();
            }
        };

        document.getElementById('confirmCreate').onclick = function() {
            console.log('–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –ª–æ–±–±–∏"');
            const lobbyName = document.getElementById('lobbyNameInput').value.trim() || '–õ–æ–±–±–∏ ' + generateGameId();
            createNewLobby(lobbyName);
        };

        document.getElementById('cancelCreate').onclick = function() {
            console.log('–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∞"');
            showScreen('mainMenu');
            document.getElementById('lobbyNameInput').value = '';
        };

        document.getElementById('startGameBtn').onclick = function() {
            console.log('–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É"');
            if (gameRef && playerSymbol === 'X') {
                gameRef.update({
                    gameStarted: true,
                    lastActivity: Date.now()
                }).catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã:', error);
                    alert('–û—à–∏–±–∫–∞ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã');
                });
            }
        };

        document.getElementById('restartGame').onclick = function() {
            console.log('–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ"');
            if (currentGameId && gameRef) {
                gameRef.once('value').then(snapshot => {
                    const gameData = snapshot.val();
                    const newGameData = {
                        board: Array(gameData.boardSize * gameData.boardSize).fill(''),
                        currentPlayer: 'X',
                        gameOver: false,
                        winner: null,
                        gameStarted: true,
                        lastActivity: Date.now()
                    };
                    
                    gameRef.update(newGameData).catch(error => console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞:', error));
                });
            }
        };

        document.getElementById('leaveGame').onclick = function() {
            console.log('–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–ü–æ–∫–∏–Ω—É—Ç—å –ª–æ–±–±–∏"');
            leaveLobby();
        };

        document.getElementById('leaveWaitingBtn').onclick = function() {
            console.log('–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–ü–æ–∫–∏–Ω—É—Ç—å –ª–æ–±–±–∏" –∏–∑ —Ä–µ–∂–∏–º–∞ –æ–∂–∏–¥–∞–Ω–∏—è');
            leaveLobby();
        };

        document.getElementById('leaveReadyBtn').onclick = function() {
            console.log('–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–ü–æ–∫–∏–Ω—É—Ç—å –ª–æ–±–±–∏" –∏–∑ —Ä–µ–∂–∏–º–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏');
            leaveLobby();
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –¥—Ä—É–∑–µ–π
        document.getElementById('showInviteFriendsBtn').addEventListener('click', showInviteFriendsPanel);
        document.getElementById('hideInviteFriendsBtn').addEventListener('click', hideInviteFriendsPanel);

        // –§–£–ù–ö–¶–ò–Ø –ë–´–°–¢–†–û–ì–û –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø
        function quickJoin() {
            console.log('–ü–æ–∏—Å–∫ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ª–æ–±–±–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...');
            
            if (lobbiesRef) {
                lobbiesRef.off();
            }
            
            lobbiesRef = database.ref('games');
            
            lobbiesRef.once('value').then((snapshot) => {
                const games = snapshot.val();
                const availableLobbies = [];
                
                if (games) {
                    Object.keys(games).forEach(gameId => {
                        const game = games[gameId];
                        if (game.gameMode === 'online' && game.playerX && !game.gameStarted) {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Å–≤–æ–±–æ–¥–Ω—ã–µ –º–µ—Å—Ç–∞
                            let connectedPlayers = 0;
                            for (let i = 1; i <= game.playersCount; i++) {
                                const symbol = playerSymbols[i].symbol;
                                if (game[`player${symbol}`]) {
                                    connectedPlayers++;
                                }
                            }
                            
                            if (connectedPlayers < game.playersCount) {
                                availableLobbies.push({
                                    id: gameId,
                                    name: game.lobbyName || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è',
                                    players: connectedPlayers,
                                    maxPlayers: game.playersCount,
                                    autoStart: game.autoStart || true,
                                    boardSize: game.boardSize || 3,
                                    winLength: game.winLength || 3
                                });
                            }
                        }
                    });
                }
                
                if (availableLobbies.length > 0) {
                    // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –ª–æ–±–±–∏
                    const randomLobby = availableLobbies[Math.floor(Math.random() * availableLobbies.length)];
                    console.log('–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –ª–æ–±–±–∏:', randomLobby.name);
                    joinLobby(randomLobby.id);
                } else {
                    alert('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ª–æ–±–±–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –ª–æ–±–±–∏!');
                    showScreen('createLobbySection');
                }
            }).catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –ª–æ–±–±–∏:', error);
                alert('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –ª–æ–±–±–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');
            });
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –°–û–ó–î–ê–ù–ò–Ø –ò –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –ö –õ–û–ë–ë–ò
        function createNewLobby(lobbyName) {
            console.log('–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ª–æ–±–±–∏:', lobbyName, '–†–µ–∂–∏–º:', gameMode, '–ò–≥—Ä–æ–∫–æ–≤:', playersCount);
            currentGameId = generateGameId();
            playerSymbol = 'X';
            
            const emptyBoard = Array(boardSize * boardSize).fill('');
            
            // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –∏–≥—Ä–æ–∫–æ–≤
            const players = {};
            for (let i = 1; i <= playersCount; i++) {
                const symbol = playerSymbols[i].symbol;
                players[`player${symbol}`] = (i === 1); // –ü–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω
            }
            
            const gameData = {
                board: emptyBoard,
                currentPlayer: 'X',
                gameOver: false,
                winner: null,
                lobbyName: lobbyName,
                createdAt: Date.now(),
                players: 1,
                lastActivity: Date.now(),
                gameStarted: false,
                autoStart: autoStart,
                boardSize: boardSize,
                winLength: winLength,
                gameMode: gameMode,
                playersCount: playersCount,
                botDifficulty: gameMode === 'bot' ? botDifficulty : null,
                ...players
            };
            
            // –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∏ —Ä–µ–∂–∏–º–∞ —Å –±–æ—Ç–æ–º —Å—Ä–∞–∑—É –Ω–∞—á–∏–Ω–∞–µ–º –∏–≥—Ä—É
            if (gameMode === 'local' || gameMode === 'bot') {
                gameData.gameStarted = true;
                gameData.players = playersCount;
                // –ü–æ–¥–∫–ª—é—á–∞–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
                for (let i = 1; i <= playersCount; i++) {
                    const symbol = playerSymbols[i].symbol;
                    gameData[`player${symbol}`] = true;
                }
            }
            
            database.ref('games/' + currentGameId).set(gameData)
                .then(() => {
                    console.log('–õ–æ–±–±–∏ —Å–æ–∑–¥–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ');
                    showScreen('gameSection');
                    setupGameListener();
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ª–æ–±–±–∏:', error);
                    alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ª–æ–±–±–∏: ' + error.message);
                });
        }

        function joinLobby(lobbyId) {
            console.log('–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –ª–æ–±–±–∏:', lobbyId);
            currentGameId = lobbyId;
            
            database.ref('games/' + currentGameId).once('value').then(snapshot => {
                if (snapshot.exists()) {
                    const gameData = snapshot.val();
                    
                    // –ù–∞—Ö–æ–¥–∏–º —Å–≤–æ–±–æ–¥–Ω—ã–π —Å–∏–º–≤–æ–ª
                    let freeSymbol = null;
                    for (let i = 1; i <= gameData.playersCount; i++) {
                        const symbol = playerSymbols[i].symbol;
                        if (!gameData[`player${symbol}`]) {
                            freeSymbol = symbol;
                            break;
                        }
                    }
                    
                    if (freeSymbol && !gameData.gameOver && !gameData.gameStarted) {
                        playerSymbol = freeSymbol;
                        
                        const updates = {
                            [`player${freeSymbol}`]: true,
                            players: gameData.players + 1,
                            lastActivity: Date.now()
                        };
                        
                        if (gameData.autoStart && (gameData.players + 1) === gameData.playersCount) {
                            updates.gameStarted = true;
                        }
                        
                        database.ref('games/' + currentGameId).update(updates)
                        .then(() => {
                            console.log('–£—Å–ø–µ—à–Ω–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –ª–æ–±–±–∏');
                            
                            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                            currentGameId = lobbyId;
                            playerSymbol = freeSymbol;
                            
                            showScreen('gameSection');
                            setupGameListener();
                            
                            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã
                            setTimeout(() => {
                                gameRef = database.ref('games/' + currentGameId);
                                gameRef.once('value').then(snapshot => {
                                    if (snapshot.exists()) {
                                        console.log('–û–±–Ω–æ–≤–ª—è–µ–º UI —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–≥—Ä—ã');
                                        updateGameUI(snapshot.val());
                                    }
                                });
                            }, 500);
                            
                        })
                        .catch(error => {
                            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:', error);
                            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –ª–æ–±–±–∏');
                            loadLobbies();
                        });
                    } else {
                        alert('–õ–æ–±–±–∏ —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –∏–ª–∏ –∏–≥—Ä–∞ —É–∂–µ –Ω–∞—á–∞—Ç–∞!');
                        loadLobbies();
                    }
                } else {
                    alert('–õ–æ–±–±–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!');
                    loadLobbies();
                }
            }).catch(error => {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ª–æ–±–±–∏');
                loadLobbies();
            });
        }

        function loadLobbies() {
            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ª–æ–±–±–∏');
            const lobbyList = document.getElementById('lobbyList');
            lobbyList.innerHTML = '<div class="empty-state" style="text-align: center; padding: 40px; color: #7f8c8d;">–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–±–±–∏...</div>';
            
            if (lobbiesRef) {
                lobbiesRef.off();
            }
            
            lobbiesRef = database.ref('games');
            
            lobbiesRef.on('value', (snapshot) => {
                const games = snapshot.val();
                console.log('–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ:', games);
                
                const lobbies = [];
                
                if (games) {
                    Object.keys(games).forEach(gameId => {
                        const game = games[gameId];
                        if (game.gameMode === 'online' && game.playerX && !game.gameStarted) {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Å–≤–æ–±–æ–¥–Ω—ã–µ –º–µ—Å—Ç–∞
                            let connectedPlayers = 0;
                            for (let i = 1; i <= game.playersCount; i++) {
                                const symbol = playerSymbols[i].symbol;
                                if (game[`player${symbol}`]) {
                                    connectedPlayers++;
                                }
                            }
                            
                            if (connectedPlayers < game.playersCount) {
                                lobbies.push({
                                    id: gameId,
                                    name: game.lobbyName || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è',
                                    players: connectedPlayers,
                                    maxPlayers: game.playersCount,
                                    autoStart: game.autoStart || true,
                                    boardSize: game.boardSize || 3,
                                    winLength: game.winLength || 3
                                });
                            }
                        }
                    });
                }
                
                console.log('–ù–∞–π–¥–µ–Ω–æ –ª–æ–±–±–∏:', lobbies.length);
                
                if (lobbies.length === 0) {
                    lobbyList.innerHTML = '<div class="empty-state" style="text-align: center; padding: 40px; color: #7f8c8d;">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ª–æ–±–±–∏. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ!</div>';
                } else {
                    renderLobbyList(lobbies);
                }
            });
        }

        function renderLobbyList(lobbies) {
            const lobbyList = document.getElementById('lobbyList');
            lobbyList.innerHTML = '';
            
            lobbies.forEach(lobby => {
                const lobbyItem = document.createElement('div');
                lobbyItem.className = 'lobby-item';
                
                const autoStartText = lobby.autoStart ? 'üöÄ –ê–≤—Ç–æ—Å—Ç–∞—Ä—Ç' : '‚è∏Ô∏è –†—É—á–Ω–æ–π —Å—Ç–∞—Ä—Ç';
                const settingsText = `–ü–æ–ª–µ: ${lobby.boardSize}√ó${lobby.boardSize} ‚Ä¢ –ü–æ–±–µ–¥–∞: ${lobby.winLength} –≤ —Ä—è–¥`;
                
                lobbyItem.innerHTML = `
                    <div class="lobby-info-panel">
                        <div class="lobby-name">${lobby.name}</div>
                        <div class="lobby-settings">${settingsText}</div>
                        <div class="lobby-players">–ò–≥—Ä–æ–∫–æ–≤: ${lobby.players}/${lobby.maxPlayers} ‚Ä¢ ${autoStartText}</div>
                    </div>
                    <button class="join-btn">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
                `;
                
                lobbyList.appendChild(lobbyItem);
                
                lobbyItem.querySelector('.join-btn').onclick = function() {
                    joinLobby(lobby.id);
                };
            });
        }

        function setupGameListener() {
            if (gameRef) {
                gameRef.off();
            }
            
            gameRef = database.ref('games/' + currentGameId);
            
            gameRef.on('value', (snapshot) => {
                const gameData = snapshot.val();
                if (gameData) {
                    currentGameData = gameData;
                    if (!gameData.gameOver) {
                        gameRef.update({
                            lastActivity: Date.now()
                        });
                    }
                    updateGameUI(gameData);
                    
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ö–æ–¥–∞ –±–æ—Ç–∞
                    if (gameData.gameMode === 'bot' && 
                        gameData.gameStarted && 
                        !gameData.gameOver && 
                        gameData.currentPlayer !== playerSymbol) {
                        setTimeout(() => makeBotMove(gameData), 500);
                    }
                }
            });
        }

        function updateGameUI(gameData) {
            document.getElementById('currentLobbyName').textContent = gameData.lobbyName || '–õ–æ–±–±–∏';
            document.getElementById('lobbySettings').textContent = `–ü–æ–ª–µ: ${gameData.boardSize}√ó${gameData.boardSize} ‚Ä¢ –ü–æ–±–µ–¥–∞: ${gameData.winLength} –≤ —Ä—è–¥ ‚Ä¢ –ò–≥—Ä–æ–∫–æ–≤: ${gameData.playersCount}`;
            
            const playerInfo = playerSymbols[getPlayerNumber(playerSymbol)];
            document.getElementById('playerSymbol').textContent = playerInfo.symbol;
            document.getElementById('playerSymbol').className = `symbol ${playerInfo.class}`;
            
            document.getElementById('winLengthInfo').textContent = `${gameData.winLength} —Ñ–∏–≥—É—Ä`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Ç–∫—É –∏–≥—Ä–æ–∫–æ–≤
            updatePlayersGrid(gameData);
            
            const modeInfo = document.getElementById('gameModeInfo');
            if (gameData.gameMode === 'online') {
                modeInfo.textContent = 'üåê –†–µ–∂–∏–º: –û–Ω–ª–∞–π–Ω —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏';
                modeInfo.style.color = '#667eea';
            } else if (gameData.gameMode === 'bot') {
                const difficultyNames = {
                    'easy': '–õ–µ–≥–∫–∏–π',
                    'medium': '–ù–æ—Ä–º–∞–ª—å–Ω—ã–π', 
                    'hard': '–°–ª–æ–∂–Ω—ã–π'
                };
                modeInfo.textContent = `ü§ñ –†–µ–∂–∏–º: –ü—Ä–æ—Ç–∏–≤ –±–æ—Ç–∞ (${difficultyNames[gameData.botDifficulty]})`;
                modeInfo.style.color = '#e74c3c';
            } else if (gameData.gameMode === 'local') {
                modeInfo.textContent = 'üë• –†–µ–∂–∏–º: –õ–æ–∫–∞–ª—å–Ω—ã–π (–≤—Å–µ –∏–≥—Ä–æ–∫–∏ –Ω–∞ –æ–¥–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ)';
                modeInfo.style.color = '#27ae60';
            }
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –¥—Ä—É–∑–µ–π
            const inviteBtnContainer = document.getElementById('inviteFriendsBtnContainer');
            const inviteSection = document.getElementById('inviteFriendsSection');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:
            // - –†–µ–∂–∏–º –æ–Ω–ª–∞–π–Ω
            // - –ò–≥—Ä–∞ –Ω–µ –Ω–∞—á–∞–ª–∞—Å—å
            // - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - —Å–æ–∑–¥–∞—Ç–µ–ª—å –ª–æ–±–±–∏ (playerSymbol === 'X')
            if (gameData.gameMode === 'online' && !gameData.gameStarted && playerSymbol === 'X') {
                inviteBtnContainer.classList.remove('hidden');
            } else {
                inviteBtnContainer.classList.add('hidden');
                inviteSection.classList.add('hidden'); // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –µ—Å–ª–∏ —É—Å–ª–æ–≤–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è
            }
            
            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
            let connectedPlayers = 0;
            for (let i = 1; i <= gameData.playersCount; i++) {
                const symbol = playerSymbols[i].symbol;
                if (gameData[`player${symbol}`]) {
                    connectedPlayers++;
                }
            }
            
            if (!gameData.gameStarted) {
                document.getElementById('status').textContent = '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã...';
                
                if (connectedPlayers < gameData.playersCount) {
                    document.getElementById('waitingSection').classList.remove('hidden');
                    document.getElementById('readySection').classList.add('hidden');
                    document.getElementById('gameContent').classList.add('hidden');
                    
                    if (playerSymbol === 'X') {
                        document.getElementById('waitingMessage').innerHTML = `‚è≥ –û–∂–∏–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤...<br><small>–ü–æ–¥–∫–ª—é—á–µ–Ω–æ: ${connectedPlayers}/${gameData.playersCount}</small>`;
                    } else {
                        document.getElementById('waitingMessage').innerHTML = `‚úÖ –í—ã –ø–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å!<br><small>–û–∂–∏–¥–∞–µ–º –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã... (${connectedPlayers}/${gameData.playersCount})</small>`;
                    }
                } else {
                    document.getElementById('waitingSection').classList.add('hidden');
                    document.getElementById('readySection').classList.remove('hidden');
                    document.getElementById('gameContent').classList.add('hidden');
                    
                    if (playerSymbol === 'X') {
                        document.getElementById('readyMessage').innerHTML = '–í—Å–µ –∏–≥—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã! –ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É" –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã.';
                        document.getElementById('startGameBtn').disabled = false;
                        document.getElementById('startGameBtn').style.display = 'block';
                    } else {
                        document.getElementById('readyMessage').innerHTML = '–í—Å–µ –∏–≥—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã! –û–∂–∏–¥–∞–µ–º –∫–æ–≥–¥–∞ —Å–æ–∑–¥–∞—Ç–µ–ª—å –ª–æ–±–±–∏ –Ω–∞—á–Ω–µ—Ç –∏–≥—Ä—É.';
                        document.getElementById('startGameBtn').style.display = 'none';
                    }
                }
                return;
            }
            
            document.getElementById('waitingSection').classList.add('hidden');
            document.getElementById('readySection').classList.add('hidden');
            document.getElementById('gameContent').classList.remove('hidden');
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —á–µ–π —Å–µ–π—á–∞—Å —Ö–æ–¥
            if (gameData.gameMode === 'local') {
                isMyTurn = true; // –í –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ —Ö–æ–¥–∏—Ç—å
            } else if (gameData.gameMode === 'bot') {
                isMyTurn = (gameData.currentPlayer === playerSymbol) && !gameData.gameOver;
            } else {
                isMyTurn = (gameData.currentPlayer === playerSymbol) && !gameData.gameOver;
            }
            
            renderBoard(gameData.board, gameData.boardSize, gameData.gameOver, gameData.gameMode);
            
            if (gameData.gameOver) {
                if (gameData.winner === 'draw') {
                    document.getElementById('status').textContent = 'ü§ù –ù–∏—á—å—è!';
                } else if (gameData.winner === playerSymbol || (gameData.gameMode === 'local' && gameData.winner)) {
                    document.getElementById('status').textContent = 'üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!';
                } else {
                    document.getElementById('status').textContent = 'üòî –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!';
                }
            } else {
                if (isMyTurn) {
                    const currentPlayerInfo = playerSymbols[getPlayerNumber(gameData.currentPlayer)];
                    document.getElementById('status').textContent = `üéØ –í–∞—à —Ö–æ–¥ (${currentPlayerInfo.symbol})`;
                } else {
                    if (gameData.gameMode === 'bot') {
                        document.getElementById('status').textContent = 'ü§ñ –•–æ–¥ –±–æ—Ç–∞...';
                    } else {
                        const currentPlayerInfo = playerSymbols[getPlayerNumber(gameData.currentPlayer)];
                        document.getElementById('status').textContent = `‚è≥ –•–æ–¥ –∏–≥—Ä–æ–∫–∞ ${currentPlayerInfo.symbol}...`;
                    }
                }
            }
        }

        function updatePlayersGrid(gameData) {
            const playersGrid = document.getElementById('playersGrid');
            playersGrid.innerHTML = '';
            
            for (let i = 1; i <= gameData.playersCount; i++) {
                const playerInfo = playerSymbols[i];
                const isConnected = gameData[`player${playerInfo.symbol}`];
                const isCurrentPlayer = gameData.currentPlayer === playerInfo.symbol;
                
                const playerCard = document.createElement('div');
                playerCard.className = `player-card ${playerInfo.class}`;
                
                playerCard.innerHTML = `
                    <div class="player-name">${playerInfo.emoji} –ò–≥—Ä–æ–∫ ${playerInfo.symbol}</div>
                    <div class="player-status">
                        ${isConnected ? '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω' : '‚ùå –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω'}
                        ${isCurrentPlayer && gameData.gameStarted ? '<br>üéØ –°–µ–π—á–∞—Å —Ö–æ–¥–∏—Ç' : ''}
                    </div>
                `;
                
                playersGrid.appendChild(playerCard);
            }
        }

        function getPlayerNumber(symbol) {
            for (let i = 1; i <= 4; i++) {
                if (playerSymbols[i].symbol === symbol) {
                    return i;
                }
            }
            return 1;
        }

        function renderBoard(boardState, size, gameOver, gameMode) {
            const board = document.getElementById('board');
            if (!board) return;
            
            board.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
            board.innerHTML = '';
            
            for (let i = 0; i < size * size; i++) {
                const cell = document.createElement('button');
                cell.className = `cell size-${Math.min(size, 10)}`;
                
                const symbol = boardState[i];
                if (symbol) {
                    cell.textContent = symbol;
                    const playerNumber = getPlayerNumber(symbol);
                    if (playerNumber) {
                        cell.classList.add(playerSymbols[playerNumber].class);
                    }
                }
                
                const isCellOccupied = boardState[i] !== '';
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –ª–∏ —è—á–µ–π–∫–∞
                if (gameMode === 'local') {
                    cell.disabled = gameOver || isCellOccupied;
                } else {
                    cell.disabled = gameOver || !isMyTurn || isCellOccupied;
                }
                
                cell.onclick = function() {
                    makeMove(i);
                };
                
                board.appendChild(cell);
            }
        }

        function makeMove(position) {
            if (!currentGameData) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –¥–ª—è —Ö–æ–¥–∞
            if (currentGameData.gameMode === 'online' && !isMyTurn) {
                return;
            }
            
            if (currentGameData.board[position] !== '' || currentGameData.gameOver) {
                return;
            }
            
            const newBoard = [...currentGameData.board];
            newBoard[position] = currentGameData.currentPlayer;
            
            const winner = checkWinner(newBoard, currentGameData.boardSize, currentGameData.winLength);
            const gameOver = winner !== null || !newBoard.includes('');
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ª–µ–¥—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
            let nextPlayer;
            const currentPlayerNumber = getPlayerNumber(currentGameData.currentPlayer);
            if (currentPlayerNumber < currentGameData.playersCount) {
                nextPlayer = playerSymbols[currentPlayerNumber + 1].symbol;
            } else {
                nextPlayer = 'X'; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø–µ—Ä–≤–æ–º—É –∏–≥—Ä–æ–∫—É
            }
            
            const updates = {
                board: newBoard,
                currentPlayer: nextPlayer,
                gameOver: gameOver,
                winner: winner,
                lastActivity: Date.now()
            };
            
            gameRef.update(updates).catch(error => {
                console.error('–û—à–∏–±–∫–∞ —Ö–æ–¥–∞:', error);
            });
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ë–û–¢–ê
        function makeBotMove(gameData) {
            const emptyCells = [];
            for (let i = 0; i < gameData.board.length; i++) {
                if (gameData.board[i] === '') {
                    emptyCells.push(i);
                }
            }
            
            if (emptyCells.length === 0) return;
            
            let botMove;
            
            switch (gameData.botDifficulty) {
                case 'easy':
                    botMove = getEasyMove(emptyCells);
                    break;
                case 'medium':
                    botMove = getMediumMove(gameData, emptyCells);
                    break;
                case 'hard':
                    botMove = getHardMove(gameData, emptyCells);
                    break;
                default:
                    botMove = getEasyMove(emptyCells);
            }
            
            const newBoard = [...gameData.board];
            newBoard[botMove] = gameData.currentPlayer;
            
            const winner = checkWinner(newBoard, gameData.boardSize, gameData.winLength);
            const gameOver = winner !== null || !newBoard.includes('');
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ª–µ–¥—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ –¥–ª—è –±–æ—Ç–∞
            let nextPlayer;
            const currentPlayerNumber = getPlayerNumber(gameData.currentPlayer);
            if (currentPlayerNumber < gameData.playersCount) {
                nextPlayer = playerSymbols[currentPlayerNumber + 1].symbol;
            } else {
                nextPlayer = 'X';
            }
            
            const updates = {
                board: newBoard,
                currentPlayer: nextPlayer,
                gameOver: gameOver,
                winner: winner,
                lastActivity: Date.now()
            };
            
            gameRef.update(updates).catch(error => {
                console.error('–û—à–∏–±–∫–∞ —Ö–æ–¥–∞ –±–æ—Ç–∞:', error);
            });
        }

        function getEasyMove(emptyCells) {
            return emptyCells[Math.floor(Math.random() * emptyCells.length)];
        }

        function getMediumMove(gameData, emptyCells) {
            if (Math.random() < 0.7) {
                return getEasyMove(emptyCells);
            } else {
                return getSmartMove(gameData, emptyCells);
            }
        }

        function getHardMove(gameData, emptyCells) {
            if (gameData.boardSize <= 5) {
                return getMinimaxMove(gameData, emptyCells);
            } else {
                return getSmartMove(gameData, emptyCells);
            }
        }

        function getSmartMove(gameData, emptyCells) {
            const board = gameData.board;
            const size = gameData.boardSize;
            const winLength = gameData.winLength;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–∏–≥—Ä—ã—à–Ω—ã–µ —Ö–æ–¥—ã –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
            for (const cell of emptyCells) {
                const testBoard = [...board];
                testBoard[cell] = gameData.currentPlayer;
                if (checkWinner(testBoard, size, winLength) === gameData.currentPlayer) {
                    return cell;
                }
            }
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—ã–∏–≥—Ä—ã—à–Ω—ã–µ —Ö–æ–¥—ã –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
            for (let i = 1; i <= gameData.playersCount; i++) {
                const symbol = playerSymbols[i].symbol;
                if (symbol !== gameData.currentPlayer) {
                    for (const cell of emptyCells) {
                        const testBoard = [...board];
                        testBoard[cell] = symbol;
                        if (checkWinner(testBoard, size, winLength) === symbol) {
                            return cell;
                        }
                    }
                }
            }
            
            const center = Math.floor(size * size / 2);
            if (emptyCells.includes(center)) return center;
            
            const corners = [0, size-1, size*(size-1), size*size-1];
            for (const corner of corners) {
                if (emptyCells.includes(corner)) return corner;
            }
            
            return getEasyMove(emptyCells);
        }

        function getMinimaxMove(gameData, emptyCells) {
            let bestScore = -Infinity;
            let bestMove = emptyCells[0];
            
            for (const cell of emptyCells) {
                const testBoard = [...gameData.board];
                testBoard[cell] = gameData.currentPlayer;
                const score = minimax(testBoard, 0, false, gameData.boardSize, gameData.winLength, gameData.currentPlayer);
                if (score > bestScore) {
                    bestScore = score;
                    bestMove = cell;
                }
            }
            
            return bestMove;
        }

        function minimax(board, depth, isMaximizing, size, winLength, maximizingPlayer) {
            const winner = checkWinner(board, size, winLength);
            
            if (winner === maximizingPlayer) return 10 - depth;
            if (winner !== null && winner !== maximizingPlayer) return depth - 10;
            if (!board.includes('')) return 0;
            
            if (isMaximizing) {
                let bestScore = -Infinity;
                for (let i = 0; i < board.length; i++) {
                    if (board[i] === '') {
                        board[i] = maximizingPlayer;
                        const score = minimax(board, depth + 1, false, size, winLength, maximizingPlayer);
                        board[i] = '';
                        bestScore = Math.max(score, bestScore);
                    }
                }
                return bestScore;
            } else {
                let bestScore = Infinity;
                for (let i = 0; i < board.length; i++) {
                    if (board[i] === '') {
                        // –•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ (—Å–ª—É—á–∞–π–Ω—ã–π –∏–∑ –≤–æ–∑–º–æ–∂–Ω—ã—Ö)
                        for (let playerNum = 1; playerNum <= 4; playerNum++) {
                            const symbol = playerSymbols[playerNum].symbol;
                            if (symbol !== maximizingPlayer && board.includes(symbol)) {
                                board[i] = symbol;
                                const score = minimax(board, depth + 1, true, size, winLength, maximizingPlayer);
                                board[i] = '';
                                bestScore = Math.min(score, bestScore);
                                break;
                            }
                        }
                    }
                }
                return bestScore;
            }
        }

        function checkWinner(board, size, winLength) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ª–∏–Ω–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Å–∏–º–≤–æ–ª–æ–≤
            const symbols = ['X', 'O', '‚ñ≥', '‚óá'];
            
            for (const symbol of symbols) {
                // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏
                for (let row = 0; row < size; row++) {
                    for (let col = 0; col <= size - winLength; col++) {
                        const index = row * size + col;
                        if (board[index] === symbol) {
                            let win = true;
                            for (let k = 1; k < winLength; k++) {
                                if (board[index + k] !== symbol) {
                                    win = false;
                                    break;
                                }
                            }
                            if (win) return symbol;
                        }
                    }
                }
                
                // –í–µ—Ä—Ç–∏–∫–∞–ª–∏
                for (let col = 0; col < size; col++) {
                    for (let row = 0; row <= size - winLength; row++) {
                        const index = row * size + col;
                        if (board[index] === symbol) {
                            let win = true;
                            for (let k = 1; k < winLength; k++) {
                                if (board[index + k * size] !== symbol) {
                                    win = false;
                                    break;
                                }
                            }
                            if (win) return symbol;
                        }
                    }
                }
                
                // –î–∏–∞–≥–æ–Ω–∞–ª–∏ (—Å–ª–µ–≤–∞-–Ω–∞–ø—Ä–∞–≤–æ)
                for (let row = 0; row <= size - winLength; row++) {
                    for (let col = 0; col <= size - winLength; col++) {
                        const index = row * size + col;
                        if (board[index] === symbol) {
                            let win = true;
                            for (let k = 1; k < winLength; k++) {
                                if (board[index + k * size + k] !== symbol) {
                                    win = false;
                                    break;
                                }
                            }
                            if (win) return symbol;
                        }
                    }
                }
                
                // –î–∏–∞–≥–æ–Ω–∞–ª–∏ (—Å–ø—Ä–∞–≤–∞-–Ω–∞–ª–µ–≤–æ)
                for (let row = 0; row <= size - winLength; row++) {
                    for (let col = winLength - 1; col < size; col++) {
                        const index = row * size + col;
                        if (board[index] === symbol) {
                            let win = true;
                            for (let k = 1; k < winLength; k++) {
                                if (board[index + k * size - k] !== symbol) {
                                    win = false;
                                    break;
                                }
                            }
                            if (win) return symbol;
                        }
                    }
                }
            }
            
            return board.includes('') ? null : 'draw';
        }

        function leaveLobby() {
            if (gameRef && currentGameId) {
                const updates = {};
                
                updates[`player${playerSymbol}`] = false;
                updates.players = currentGameData.players - 1;
                updates.gameStarted = false;
                
                gameRef.update(updates).then(() => {
                    gameRef.off();
                    resetUI();
                }).catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:', error);
                    resetUI();
                });
            } else {
                resetUI();
            }
        }

        function resetUI() {
            currentGameId = null;
            playerSymbol = null;
            isMyTurn = false;
            currentGameData = null;
            
            // –û—á–∏—â–∞–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
            sentInvites = {};
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
            hideInviteFriendsPanel();
            
            showScreen('mainMenu');
            document.getElementById('status').textContent = '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤...';
            
            const board = document.getElementById('board');
            if (board) board.innerHTML = '';
            
            document.getElementById('currentLobbyName').textContent = '';
            document.getElementById('lobbySettings').textContent = '';
            document.getElementById('playerSymbol').textContent = '';
            document.getElementById('gameModeInfo').textContent = '';
            document.getElementById('playersGrid').innerHTML = '';
            
            document.getElementById('waitingSection').classList.remove('hidden');
            document.getElementById('readySection').classList.add('hidden');
            document.getElementById('gameContent').classList.add('hidden');
            
            // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–≥—Ä—ã –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –≤ –º–µ–Ω—é
            document.querySelector('.game-container').classList.remove('game-section-active');
        }

        function generateGameId() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ù–ê–°–¢–†–û–ï–ö
        document.getElementById('boardSizeSelect').onchange = function() {
            boardSize = parseInt(this.value);
            updateWinLengthOptions();
        };

        document.getElementById('winLengthSelect').onchange = function() {
            winLength = parseInt(this.value);
        };

        document.getElementById('autoStartCheckbox').onchange = function() {
            autoStart = this.checked;
        };

        // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –†–ï–ñ–ò–ú–û–í –ò –°–õ–û–ñ–ù–û–°–¢–ò
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.onclick = function() {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('selected'));
                this.classList.add('selected');
                gameMode = this.dataset.mode;
                
                const difficultyGroup = document.getElementById('difficultyGroup');
                if (gameMode === 'bot') {
                    difficultyGroup.classList.add('visible');
                    document.getElementById('autoStartGroup').style.display = 'none';
                } else {
                    difficultyGroup.classList.remove('visible');
                    document.getElementById('autoStartGroup').style.display = 'flex';
                }
                
                if (gameMode === 'local') {
                    document.getElementById('autoStartGroup').style.display = 'none';
                }
            };
        });

        // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–û–õ–ò–ß–ï–°–¢–í–ê –ò–ì–†–û–ö–û–í
        document.querySelectorAll('.players-btn').forEach(btn => {
            btn.onclick = function() {
                document.querySelectorAll('.players-btn').forEach(b => b.classList.remove('selected'));
                this.classList.add('selected');
                playersCount = parseInt(this.dataset.players);
                updateBoardSizeOptions();
            };
        });

        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.onclick = function() {
                document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('selected'));
                this.classList.add('selected');
                botDifficulty = this.dataset.difficulty;
            };
        });

        // –û–ë–ù–û–í–õ–ï–ù–ò–ï –î–û–°–¢–£–ü–ù–´–• –†–ê–ó–ú–ï–†–û–í –ü–û–õ–Ø
        function updateBoardSizeOptions() {
            const sizeSelect = document.getElementById('boardSizeSelect');
            const currentSize = parseInt(sizeSelect.value);
            
            // –û—á–∏—â–∞–µ–º options
            sizeSelect.innerHTML = '';
            
            let availableSizes = [];
            
            if (playersCount === 2) {
                availableSizes = [3, 4, 5, 7, 8, 10];
            } else if (playersCount === 3) {
                availableSizes = [7, 8, 10];
            } else if (playersCount === 4) {
                availableSizes = [8, 10];
            }
            
            availableSizes.forEach(size => {
                const option = document.createElement('option');
                option.value = size;
                if (size === 3) {
                    option.textContent = `${size}√ó${size} (–ö–ª–∞—Å—Å–∏–∫–∞)`;
                } else {
                    option.textContent = `${size}√ó${size}`;
                }
                sizeSelect.appendChild(option);
            });
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ä–∞–∑–º–µ—Ä
            if (availableSizes.includes(currentSize)) {
                sizeSelect.value = currentSize;
            } else {
                sizeSelect.value = availableSizes[0];
            }
            
            boardSize = parseInt(sizeSelect.value);
            updateWinLengthOptions();
        }

        function updateWinLengthOptions() {
            const currentWinLength = parseInt(document.getElementById('winLengthSelect').value);
            const select = document.getElementById('winLengthSelect');
            select.innerHTML = '';
            
            const maxWinLength = Math.min(6, boardSize);
            const minWinLength = 3;
            
            for (let i = minWinLength; i <= maxWinLength; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i + (i === 1 ? ' —Ñ–∏–≥—É—Ä–∞' : i < 5 ? ' —Ñ–∏–≥—É—Ä—ã' : ' —Ñ–∏–≥—É—Ä');
                select.appendChild(option);
            }
            
            if (currentWinLength <= maxWinLength && currentWinLength >= minWinLength) {
                select.value = currentWinLength;
            } else {
                select.value = Math.min(3, maxWinLength);
            }
            
            winLength = parseInt(select.value);
        }

        // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ì–õ–ê–í–ù–´–• –í–ö–õ–ê–î–û–ö
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–µ
                this.classList.add('active');
                
                const tabName = this.dataset.tab;
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                document.getElementById(tabName + 'Tab').classList.remove('hidden');
                
                // –ï—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É –∏–≥—Ä—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
                if (tabName === 'game') {
                    showScreen('mainMenu');
                }
                
                // –ï—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Å–æ–æ–±—â–µ—Å—Ç–≤–∞, –∑–∞–≥—Ä—É–∂–∞–µ–º –¥—Ä—É–∑–µ–π
                if (tabName === 'community' && isLoggedIn) {
                    loadFriends();
                    loadSkins();
                }
            });
        });

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï
        window.onload = function() {
            console.log('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!');
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –æ–Ω–ª–∞–π–Ω
            setupButtonHandlers();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            const savedUser = localStorage.getItem('xo_currentUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    isLoggedIn = true;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', e);
                    localStorage.removeItem('xo_currentUser');
                }
            }
            
            updateAccountUI();
            updateGameButtons();
            updateWinLengthOptions();
            updateBoardSizeOptions();
            showScreen('mainMenu');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥—Ä—É–∑–µ–π –∏ —Å–∫–∏–Ω—ã –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
            if (isLoggedIn) {
                loadFriends();
                loadSkins();
                setupInviteListener();
                setupSentInvitesListener();
            }
        };
    </script>
</body>
</html>
